<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- 
        Autor: Jossian Brito
        Data: 2025-12-10
        Vers√£o: 15.0 - MOBILE FIRST EDITION
        
        Modifica√ß√µes Implementadas (v15.0 - Mobile First):
        - REDESIGN COMPLETO: Layout mobile-first com sidebars como bottom sheets
        - TOUCH-FRIENDLY: Controles maiores e otimizados para toque
        - RESPONSIVE: Grid adaptativo que se expande para desktop
        - UX MELHORADA: Navega√ß√£o por abas e modais deslizantes
    -->

    <title>TUGLORDS v15.0 - Mobile First Edition</title>

    <script src="https://cdn-tailwindcss.vercel.app/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root{ 
            --dice-roll-ms: 1200ms; 
            --notif-trans-ms: 500ms;
            --primary-blue: #1e3c72;
            --secondary-blue: #2a5298;
            --accent-gold: #fbbf24;
            --dark-panel: #1a2942;
            --light-panel: #233a60;
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            color: #e0e0e0;
            min-height: 100vh;
            position: relative;
        }

        /* ===== MOBILE FIRST LAYOUT ===== */
		
		
        .game-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding-bottom: 70px; /* Espa√ßo para bottom nav */
        }

        /* Header Mobile */
        .mobile-header {
            background: var(--dark-panel);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .mobile-header h1 {
            font-size: 1.25rem;
            font-weight: 900;
            margin: 0;
            color: var(--accent-gold);
        }

        .header-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 0.875rem;
        }

        /* Main Game Board */
        .game-board-wrapper {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Bottom Navigation - Mobile */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-panel);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0;
            padding: 0.5rem 0.5rem calc(0.5rem + env(safe-area-inset-bottom));
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: #94a3b8;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 0.5rem;
        }

        .nav-btn:active {
            transform: scale(0.95);
            background: rgba(255,255,255,0.1);
        }

        .nav-btn.active {
            color: var(--accent-gold);
            background: rgba(251, 191, 36, 0.1);
        }

        .nav-btn-icon {
            font-size: 1.5rem;
        }

        /* Sliding Panels - Mobile */
        .sliding-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--light-panel);
            border-radius: 1.5rem 1.5rem 0 0;
            max-height: 85vh;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 200;
            overflow: hidden;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
        }

        .sliding-panel.active {
            transform: translateY(0);
        }

        .panel-handle {
            width: 40px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            margin: 0.75rem auto;
        }

        .panel-content {
            padding: 0 1.5rem 1.5rem;
            overflow-y: auto;
            max-height: calc(85vh - 100px);
        }

        .panel-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--light-panel);
            z-index: 10;
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }

        .panel-close {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #e0e0e0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Overlay */
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 150;
        }

        .panel-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Touch-Friendly Buttons */
        .btn-primary {
            background: var(--accent-gold);
            color: #1a2942;
            border: none;
            padding: 0.875rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px; /* iOS minimum touch target */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary:active {
            transform: scale(0.97);
            background: #f59e0b;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.875rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
        }

        .btn-secondary:active {
            background: rgba(255,255,255,0.2);
        }

        /* Player Cards - Mobile Optimized */
        .player-card {
            background: rgba(255,255,255,0.05);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .player-card.active {
            border-color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .player-name {
            font-size: 1.125rem;
            font-weight: 700;
        }

        .player-money {
            font-size: 1.25rem;
            font-weight: 900;
            color: var(--accent-gold);
        }

        /* Tabs Mobile */
        .tabs-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-btn {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 0.5rem;
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            min-height: 36px;
        }

        .tab-btn.active {
            background: var(--accent-gold);
            color: #1a2942;
            border-color: var(--accent-gold);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Board Styles - Responsive */
        .board-container {
            background: rgba(255,255,255,0.05);
            border-radius: 1rem;
            padding: 1rem;
            min-height: 400px;
        }

        /* ===== TABLET & DESKTOP (min-width: 768px) ===== */
        @media (min-width: 768px) {
            .game-container {
                padding-bottom: 0;
            }

            .mobile-header {
                padding: 1rem 2rem;
            }

            .mobile-header h1 {
                font-size: 1.5rem;
            }

            .bottom-nav {
                position: relative;
                grid-template-columns: repeat(4, 1fr);
                max-width: 600px;
                margin: 0 auto;
                border-radius: 1rem;
                bottom: auto;
            }

            .game-board-wrapper {
                padding: 2rem;
            }

            .sliding-panel {
                max-width: 480px;
                left: auto;
                right: 0;
                max-height: 100vh;
                border-radius: 1rem 0 0 1rem;
            }

            .panel-content {
                max-height: calc(100vh - 140px);
            }
        }

        /* ===== DESKTOP (min-width: 1024px) ===== */
        @media (min-width: 1024px) {
            .game-container {
                display: grid;
                grid-template-columns: 360px 1fr 360px;
                gap: 1.5rem;
                padding: 1.5rem;
                max-width: 1800px;
                margin: 0 auto;
            }

            .mobile-header {
                display: none;
            }

            .bottom-nav {
                display: none;
            }

            .game-board-wrapper {
                order: 2;
                padding: 0;
            }

            .sliding-panel {
                position: relative;
                transform: translateY(0) !important;
                max-height: calc(100vh - 3rem);
                border-radius: 1rem;
                max-width: none;
                right: auto;
            }

            .sliding-panel.panel-left {
                order: 1;
            }

            .sliding-panel.panel-right {
                order: 3;
            }

            .panel-handle {
                display: none;
            }

            .panel-overlay {
                display: none;
            }

            .panel-close {
                display: none;
            }
        }

        /* Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        /* Progress Indicators */
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gold);
            transition: width 0.3s;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }

        /* ===== SETUP SCREEN STYLES ===== */
        .setup-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .setup-container {
            background: var(--light-panel);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        .setup-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .setup-header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--accent-gold);
            margin: 0 0 0.5rem 0;
        }

        .setup-header p {
            color: #94a3b8;
            margin: 0;
        }

        .player-setup-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .player-setup-card {
            background: rgba(255,255,255,0.05);
            border-radius: 0.75rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 4px solid;
            transition: all 0.2s;
        }

        .player-setup-card:hover {
            background: rgba(255,255,255,0.08);
        }

        .player-name-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            color: #e0e0e0;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            flex: 1;
            min-height: 40px;
        }

        .player-name-input:focus {
            outline: none;
            border-color: var(--accent-gold);
            background: rgba(255,255,255,0.15);
        }

        .player-roll-result {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
            color: var(--accent-gold);
        }

        .btn-remove {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            width: 36px;
            height: 36px;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn-remove:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .setup-actions {
            display: flex;
            gap: 0.75rem;
            flex-direction: column;
        }

        .setup-actions .btn-primary,
        .setup-actions .btn-secondary {
            width: 100%;
        }

        .order-results {
            background: rgba(255,255,255,0.05);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .order-results h3 {
            text-align: center;
            margin: 0 0 1rem 0;
            font-size: 1.25rem;
            color: var(--accent-gold);
        }

        .order-item {
            background: rgba(255,255,255,0.05);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 4px solid;
        }

        .order-item:last-child {
            margin-bottom: 1.5rem;
        }

        .game-screen {
            width: 100%;
        }

        @media (min-width: 768px) {
            .setup-container {
                padding: 3rem;
            }

            .setup-header h1 {
                font-size: 3rem;
            }

            .setup-actions {
                flex-direction: row;
            }
        }

        /* ===== BOARD STYLES ===== */
        .board-game {
            aspect-ratio: 1;
            max-width: 600px;
            margin: 0 auto 2rem;
            background: rgba(255,255,255,0.05);
            border-radius: 1rem;
            padding: 0.5rem;
            position: relative;
            display: grid;
            grid-template-columns: 1fr 6fr 1fr;
            grid-template-rows: 1fr 6fr 1fr;
            gap: 0.25rem;
        }

        .board-corner {
            background: linear-gradient(135deg, var(--accent-gold), #f59e0b);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: #1a2942;
            position: relative;
        }

        .board-corner-label {
            position: absolute;
            bottom: 0.25rem;
            font-size: 0.625rem;
            font-weight: 700;
            text-align: center;
            width: 100%;
        }

        .board-side {
            display: flex;
            gap: 0.25rem;
        }

        .board-side.top,
        .board-side.bottom {
            flex-direction: row;
        }

        .board-side.left,
        .board-side.right {
            flex-direction: column;
        }

        .board-house {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 0.5rem;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            gap: 0.25rem;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .board-house:hover {
            background: rgba(255,255,255,0.15);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .board-house.active {
            background: rgba(251, 191, 36, 0.2);
            border-color: var(--accent-gold);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.4);
            animation: pulseHouse 0.5s ease-in-out;
        }

        @keyframes pulseHouse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .house-icon {
            font-size: 1.5rem;
        }

        .house-name {
            font-size: 0.625rem;
            font-weight: 600;
            text-align: center;
            line-height: 1.2;
            color: #e0e0e0;
        }

        .house-price {
            font-size: 0.5rem;
            color: var(--accent-gold);
            font-weight: 700;
        }

        .house-players {
            display: flex;
            gap: 0.125rem;
            flex-wrap: wrap;
            justify-content: center;
            position: absolute;
            bottom: 0.25rem;
        }

        .player-pawn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.5);
            font-size: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .board-center {
            background: rgba(0,0,0,0.3);
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            grid-column: 2;
            grid-row: 2;
        }

        .board-center h3 {
            font-size: 1.5rem;
            font-weight: 900;
            margin: 0 0 0.5rem 0;
            color: var(--accent-gold);
        }

        .board-center-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        @media (min-width: 768px) {
            .board-game {
                max-width: 700px;
            }

            .house-icon {
                font-size: 2rem;
            }

            .house-name {
                font-size: 0.75rem;
            }

            .house-price {
                font-size: 0.625rem;
            }

            .player-pawn {
                width: 16px;
                height: 16px;
                font-size: 0.625rem;
            }
        }
    </style>
</head>
<body>
    <!-- ========== TELA INICIAL - SELE√á√ÉO DE ORDEM ========== -->
    <div id="setupScreen" class="setup-screen">
        <div class="setup-container">
            <div class="setup-header">
                <h1>‚öì TUGLORDS</h1>
                <p>Quem come√ßa? Role os dados para decidir!</p>
            </div>

            <div id="playerSetupList" class="player-setup-list">
                <!-- Players ser√£o gerados aqui -->
            </div>

            <div class="setup-actions">
                <button class="btn-primary" onclick="addPlayer()">‚ûï Adicionar Jogador</button>
                <button class="btn-secondary" id="startOrderBtn" onclick="startOrderRolls()" disabled>
                    üé≤ Iniciar Sorteio
                </button>
            </div>

            <div id="orderResults" class="order-results" style="display: none;">
                <h3>üìã Ordem dos Jogadores</h3>
                <div id="orderList"></div>
                <button class="btn-primary" onclick="startGame()">
                    üö¢ Come√ßar Jogo!
                </button>
            </div>
        </div>
    </div>

    <!-- ========== TELA DO JOGO ========== -->
    <div id="gameScreen" class="game-screen" style="display: none;">
        <!-- Mobile Header -->
        <div class="mobile-header">
            <h1>‚öì TUGLORDS</h1>
            <div class="header-stats">
                <span id="currentPlayerName">Jogador 1</span>
                <span>|</span>
                <span id="currentRound">Rodada 1</span>
            </div>
        </div>

        <!-- Main Container -->
        <div class="game-container">
            
            <!-- Left Panel - Players -->
            <div class="sliding-panel panel-left" id="panelPlayers">
                <div class="panel-handle"></div>
                <div class="panel-header">
                    <h2 class="panel-title">üë• Jogadores</h2>
                    <button class="panel-close" onclick="closePanel('panelPlayers')">‚úï</button>
                </div>
                <div class="panel-content">
                    <div id="playersContainer">
                        <!-- Player cards ser√£o gerados dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Center - Game Board -->
            <div class="game-board-wrapper">
                <div class="board-container">
                    <!-- Visual Board -->
                    <div id="visualBoard"></div>

                    <!-- Game Controls -->
                    <div style="text-align: center; padding: 1rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 900; margin-bottom: 1rem;">
                            üé≤ Turno de <span id="currentTurnPlayer">Jogador</span>
                        </h2>
                        
                        <!-- Dice Display -->
                        <div id="diceDisplay" style="font-size: 3rem; margin: 1rem 0;">
                            ‚öÄ ‚öÄ
                        </div>

                        <!-- Dice Button -->
                        <div style="margin-bottom: 1.5rem;">
                            <button id="rollDiceBtn" class="btn-primary" onclick="rollDice()" style="font-size: 1.125rem;">
                                üé≤ Jogar Dados
                            </button>
                        </div>

                        <!-- Current Position Info -->
                        <div id="positionInfo" style="background: rgba(255,255,255,0.1); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem;">
                            <p id="currentHouseName" style="font-size: 1.25rem; color: var(--accent-gold); margin: 0; font-weight: 700;">
                                Casa Inicial
                            </p>
                        </div>

                        <!-- Contextual Actions (aparecem baseado na casa) -->
                        <div id="contextualActions" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;">
                                <!-- Bot√µes ser√£o adicionados dinamicamente -->
                            </div>
                        </div>

                        <!-- End Turn Button -->
                        <div style="margin-top: 1.5rem;">
                            <button id="endTurnBtn" class="btn-secondary" onclick="endTurn()" style="width: 100%; max-width: 300px;">
                                ‚û°Ô∏è Finalizar Turno
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Bank & Info -->
            <div class="sliding-panel panel-right" id="panelBank">
                <div class="panel-handle"></div>
                <div class="panel-header">
                    <h2 class="panel-title">üè¶ Terminal Banc√°rio</h2>
                    <button class="panel-close" onclick="closePanel('panelBank')">‚úï</button>
                </div>
                <div class="panel-content">
                    <div style="background: rgba(255,255,255,0.05); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 1rem;">üí≥ Empr√©stimos</h3>
                        <div style="display: grid; gap: 0.75rem;">
                            <button class="btn-secondary" style="justify-content: space-between;">
                                <span>R$ 5.000</span>
                                <span style="font-size: 0.875rem; opacity: 0.7;">Juros: 10%</span>
                            </button>
                            <button class="btn-secondary" style="justify-content: space-between;">
                                <span>R$ 10.000</span>
                                <span style="font-size: 0.875rem; opacity: 0.7;">Juros: 15%</span>
                            </button>
                            <button class="btn-secondary" style="justify-content: space-between;">
                                <span>R$ 20.000</span>
                                <span style="font-size: 0.875rem; opacity: 0.7;">Juros: 20%</span>
                            </button>
                        </div>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 1rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 1rem;">üìä Mercado de A√ß√µes</h3>
                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 0.5rem;">
                                <span>TUGLIFE</span>
                                <span style="color: #10b981;">+5.2%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
                                <span>OCEANIC</span>
                                <span style="color: #ef4444;">-2.8%</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); border-radius: 0.75rem; padding: 1.5rem;">
                        <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 1rem;">üìú Regras R√°pidas</h3>
                        <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.875rem; line-height: 1.6; color: #94a3b8;">
                            <li style="margin-bottom: 0.5rem;">üéØ Objetivo: Dominar o mercado de rebocadores</li>
                            <li style="margin-bottom: 0.5rem;">üé≤ Role os dados para mover</li>
                            <li style="margin-bottom: 0.5rem;">‚öì Compre portos e rebocadores</li>
                            <li style="margin-bottom: 0.5rem;">üí∞ Gerencie suas finan√ßas</li>
                            <li>üèÜ Seja o primeiro a completar todos objetivos</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation - Mobile -->
        <nav class="bottom-nav">
            <button class="nav-btn active" onclick="openPanel('panelPlayers', this)">
                <span class="nav-btn-icon">üë•</span>
                <span>Jogadores</span>
            </button>
            <button class="nav-btn" onclick="toggleBoard(this)">
                <span class="nav-btn-icon">üé≤</span>
                <span>Tabuleiro</span>
            </button>
            <button class="nav-btn" onclick="openPanel('panelBank', this)">
                <span class="nav-btn-icon">üè¶</span>
                <span>Banco</span>
            </button>
            <button class="nav-btn" onclick="openPanel('panelMenu', this)">
                <span class="nav-btn-icon">‚öôÔ∏è</span>
                <span>Menu</span>
            </button>
        </nav>

        <!-- Overlay -->
        <div class="panel-overlay" id="panelOverlay" onclick="closeAllPanels()"></div>

        <!-- Menu Panel -->
        <div class="sliding-panel" id="panelMenu">
            <div class="panel-handle"></div>
            <div class="panel-header">
                <h2 class="panel-title">‚öôÔ∏è Menu</h2>
                <button class="panel-close" onclick="closePanel('panelMenu')">‚úï</button>
            </div>
            <div class="panel-content">
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <button class="btn-primary">üìñ Manual do Jogo</button>
                    <button class="btn-primary">üèÜ Vit√≥ria √âpica</button>
                    <button class="btn-secondary">‚öôÔ∏è Configura√ß√µes</button>
                    <button class="btn-secondary">üìä Estat√≠sticas</button>
                    <button class="btn-secondary">üíæ Salvar Jogo</button>
                    <button class="btn-secondary">üì§ Carregar Jogo</button>
                    <button class="btn-secondary" style="color: #ef4444;">üö™ Sair</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== GAME STATE ==========
        const gameState = {
            players: [],
            currentPlayerIndex: 0,
            currentRound: 1,
            phase: 'setup', // setup, playing
            playerOrder: [],
            diceRolled: false,
            houses: [
                { name: 'Casa Inicial', type: 'start', actions: [] },
                { name: 'Porto de Fortaleza', type: 'port', price: 5000, actions: ['buy'] },
                { name: 'Evento Oce√¢nico', type: 'event', actions: [] },
                { name: 'Porto de Santos', type: 'port', price: 7000, actions: ['buy'] },
                { name: 'Posto de Combust√≠vel', type: 'fuel', price: 3000, actions: ['buy'] },
                { name: 'Banco', type: 'bank', actions: ['loan'] },
                { name: 'Porto do Rio', type: 'port', price: 8000, actions: ['buy'] },
                { name: 'Carta Surpresa', type: 'surprise', actions: [] },
                { name: 'Oficina Naval', type: 'workshop', price: 4000, actions: ['buy'] },
                { name: 'Porto de Salvador', type: 'port', price: 6000, actions: ['buy'] }
            ]
        };

        // ========== SISTEMA DE EXAMES: PERGUNTAS DOS TREINAMENTOS ==========
        const TRAINING_QUESTIONS = {
            fire: [
                {
                    question: "Qual √© a primeira a√ß√£o ao descobrir um inc√™ndio a bordo?",
                    options: [
                        "Abandonar o navio imediatamente",
                        "Tentar apagar com √°gua do mar",
                        "Soar o alarme geral",
                        "Contactar o armador"
                    ],
                    correct: "Soar o alarme geral"
                },
                {
                    question: "Qual classe de inc√™ndio envolve l√≠quidos inflam√°veis?",
                    options: [
                        "Classe A",
                        "Classe B",
                        "Classe C",
                        "Classe D"
                    ],
                    correct: "Classe B"
                }
            ],
            rescue: [
                {
                    question: "Qual manobra √© usada para resgatar homem ao mar?",
                    options: [
                        "Manobra de Scharnow",
                        "Manobra de Williamson",
                        "Manobra de Anderson",
                        "Manobra de Boutakov"
                    ],
                    correct: "Manobra de Williamson"
                },
                {
                    question: "Qual equipamento deve ser lan√ßado primeiro para homem ao mar?",
                    options: [
                        "Colete salva-vidas",
                        "Boia circular",
                        "Corda com n√≥",
                        "Escada de embarque"
                    ],
                    correct: "Boia circular"
                }
            ],
            collision: [
                {
                    question: "Qual √© a regra de ouro para evitar colis√µes no mar?",
                    options: [
                        "M√°quinas sempre prontas",
                        "Vig√≠lia constante",
                        "Velocidade reduzida",
                        "Sinais sonoros cont√≠nuos"
                    ],
                    correct: "Vig√≠lia constante"
                },
                {
                    question: "Em situa√ß√£o de risco de colis√£o, qual embarca√ß√£o deve manobrar?",
                    options: [
                        "A menor embarca√ß√£o",
                        "A que avista primeiro",
                        "A que tem o outro por bombordo",
                        "A que tem o outro por boreste"
                    ],
                    correct: "A que tem o outro por boreste"
                }
            ],
            abandon: [
                {
                    question: "Qual sinal sonoro indica abandono de navio?",
                    options: [
                        "Um apito longo",
                        "Tr√™s apitos curtos",
                        "Sete apitos curtos e um longo",
                        "Dois apitos longos"
                    ],
                    correct: "Sete apitos curtos e um longo"
                },
                {
                    question: "O que √© EPIRB?",
                    options: [
                        "Equipamento de primeiros socorros",
                        "Radiobaliza de localiza√ß√£o de sinistros",
                        "Equipamento de prote√ß√£o individual",
                        "Extintor port√°til de inc√™ndio"
                    ],
                    correct: "Radiobaliza de localiza√ß√£o de sinistros"
                }
            ]
        };

        // ========== EVENTOS OCE√ÇNICOS ==========
        const OCEAN_EVENTS = [
            // EVENTOS POSITIVOS (4)
            {
                id: 1,
                name: 'Vento Favor√°vel',
                icon: '‚õµ',
                description: 'As correntes est√£o a seu favor!',
                effect: 'Avance at√© a pr√≥xima propriedade sem pagar aluguel',
                type: 'advance_to_property',
                skipRent: true
            },
            {
                id: 2,
                name: 'Avistamento de Baleias',
                icon: 'üêã',
                description: 'Contrato de pesquisa marinha!',
                effect: 'Receba R$300 de contrato cient√≠fico',
                type: 'money',
                amount: 300
            },
            {
                id: 3,
                name: 'Corrente do Brasil',
                icon: 'üåä',
                description: 'Corrente oce√¢nica acelera sua navega√ß√£o!',
                effect: 'Avance 5 casas',
                type: 'move',
                spaces: 5
            },
            {
                id: 4,
                name: 'Contrato de Emerg√™ncia',
                icon: 'üì°',
                description: 'Reboque emergencial bem remunerado!',
                effect: 'Receba R$500 imediatamente',
                type: 'money',
                amount: 500
            },
            
            // EVENTOS NEGATIVOS (3)
            {
                id: 5,
                name: 'Tempestade Tropical',
                icon: 'üåÄ',
                description: 'Condi√ß√µes adversas for√ßam retorno!',
                effect: 'Volte √† √∫ltima propriedade visitada',
                type: 'return_to_last_property'
            },
            {
                id: 6,
                name: 'Avaria no Motor',
                icon: '‚ö†Ô∏è',
                description: 'Reparo emergencial necess√°rio!',
                effect: 'Pague R$200 de manuten√ß√£o',
                type: 'money',
                amount: -200
            },
            {
                id: 7,
                name: 'Zona de Risco',
                icon: 'ü¶à',
                description: 'Navega√ß√£o perigosa! Docagem preventiva.',
                effect: 'Perca o pr√≥ximo turno',
                type: 'skip_turn'
            },
            
            // EVENTOS NEUTROS/MISTOS (3)
            {
                id: 8,
                name: 'Inspe√ß√£o da Marinha',
                icon: 'üè¥‚Äç‚ò†Ô∏è',
                description: 'Fiscaliza√ß√£o de seguran√ßa mar√≠tima',
                effect: 'Certificados completos = R$200 | Incompleto = R$150 multa',
                type: 'inspection'
            },
            {
                id: 9,
                name: 'Oportunidade de Salvamento',
                icon: 'üé£',
                description: 'Embarca√ß√£o em perigo solicita aux√≠lio',
                effect: 'Aceitar: +R$400 mas perca turno | Recusar: continue',
                type: 'choice_salvage'
            },
            {
                id: 10,
                name: 'Escolha de Rota',
                icon: 'üåÖ',
                description: 'Duas rotas dispon√≠veis para seu destino',
                effect: 'Rota Norte: +3 casas | Rota Sul: +R$250',
                type: 'choice_route'
            }
        ];

        const playerColors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];
        const playerIcons = ['‚öì', 'üö¢', '‚õµ', 'üõü', 'üé£', 'üè¥‚Äç‚ò†Ô∏è'];

        // ========== SETUP FUNCTIONS ==========
        function addPlayer() {
            const playerNum = gameState.players.length + 1;
            if (playerNum > 6) {
                showNotification('M√°ximo de 6 jogadores!');
                return;
            }

            const player = {
                id: playerNum,
                name: `Jogador ${playerNum}`,
                icon: playerIcons[playerNum - 1],
                color: playerColors[playerNum - 1],
                money: 1500, // R$1.500 inicial
                position: 0,
                properties: [],
                rolled: false,
                rollValue: 0,
                // ===== SISTEMA DE REBOCADORES =====
                portTugs: 0,                    // Quantidade de rebocadores portu√°rios
                hasOceanTug: false,             // Tem rebocador oce√¢nico?
                hasTuglord: false,              // Tem classe TugLord?
                // ===== SISTEMA DE DOCAGEM =====
                dockedTugs: {
                    port: 0,                    // Portu√°rios docados
                    ocean: false,               // Oce√¢nico docado?
                    tuglord: false,             // TugLord docado?
                    turnsRemaining: 0           // Turnos restantes de docagem
                },
                // ===== SISTEMA DE CERTIFICADOS =====
                certificates: [],               // Lista de certificados obtidos
                // ===== SISTEMA BANC√ÅRIO =====
                loans: [],                      // Array de empr√©stimos [{amount, interest, turns}]
                // ===== BOLSA DE VALORES =====
                stocks: {},                     // A√ß√µes por propriedade {propertyName: quantity}
                // ===== SISTEMA DE FAL√äNCIA =====
                bankruptcyStage: 0,             // 0=solvente, 1=arresto, 2=falido
                isEliminated: false,            // Eliminado do jogo?
                // ===== EVENTOS OCE√ÇNICOS =====
                skipNextTurn: false,            // Pular pr√≥ximo turno?
                skipNextRent: false             // N√£o pagar pr√≥ximo aluguel?
            };

            gameState.players.push(player);
            renderPlayerSetupList();
            
            // Enable start button if at least 2 players
            if (gameState.players.length >= 2) {
                document.getElementById('startOrderBtn').disabled = false;
            }
        }

        function renderPlayerSetupList() {
            const container = document.getElementById('playerSetupList');
            container.innerHTML = gameState.players.map(player => `
                <div class="player-setup-card" style="border-left: 4px solid ${player.color};">
                    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                        <span style="font-size: 2rem;">${player.icon}</span>
                        <input 
                            type="text" 
                            value="${player.name}" 
                            onchange="updatePlayerName(${player.id}, this.value)"
                            class="player-name-input"
                            placeholder="Nome do jogador"
                        />
                    </div>
                    <div id="roll-${player.id}" class="player-roll-result">
                        ${player.rolled ? `üé≤ ${player.rollValue}` : ''}
                    </div>
                    <button class="btn-remove" onclick="removePlayer(${player.id})">‚úï</button>
                </div>
            `).join('');
        }

        function updatePlayerName(playerId, newName) {
            const player = gameState.players.find(p => p.id === playerId);
            if (player) {
                player.name = newName || `Jogador ${playerId}`;
            }
        }

        function removePlayer(playerId) {
            gameState.players = gameState.players.filter(p => p.id !== playerId);
            renderPlayerSetupList();
            
            if (gameState.players.length < 2) {
                document.getElementById('startOrderBtn').disabled = true;
            }
        }

        function startOrderRolls() {
            let currentPlayerIndex = 0;
            const rollInterval = setInterval(() => {
                if (currentPlayerIndex >= gameState.players.length) {
                    clearInterval(rollInterval);
                    determineOrder();
                    return;
                }

                const player = gameState.players[currentPlayerIndex];
                const rollValue = Math.floor(Math.random() * 6) + 1 + Math.floor(Math.random() * 6) + 1;
                player.rolled = true;
                player.rollValue = rollValue;

                // Animate dice
                const rollElement = document.getElementById(`roll-${player.id}`);
                let animCount = 0;
                const animInterval = setInterval(() => {
                    const rand = Math.floor(Math.random() * 6) + 1 + Math.floor(Math.random() * 6) + 1;
                    rollElement.textContent = `üé≤ ${rand}`;
                    animCount++;
                    
                    if (animCount > 10) {
                        clearInterval(animInterval);
                        rollElement.textContent = `üé≤ ${rollValue}`;
                        rollElement.style.animation = 'pulse 0.5s';
                    }
                }, 100);

                currentPlayerIndex++;
            }, 1500);
        }

        function determineOrder() {
            // Sort by roll value (highest first)
            gameState.playerOrder = [...gameState.players].sort((a, b) => b.rollValue - a.rollValue);
            
            // Show results
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = gameState.playerOrder.map((player, index) => `
                <div class="order-item" style="border-left: 4px solid ${player.color};">
                    <span style="font-size: 1.5rem; width: 40px;">${index + 1}¬∫</span>
                    <span style="font-size: 1.5rem;">${player.icon}</span>
                    <span style="flex: 1; font-weight: 600;">${player.name}</span>
                    <span style="font-weight: 700; color: var(--accent-gold);">üé≤ ${player.rollValue}</span>
                </div>
            `).join('');

            document.getElementById('orderResults').style.display = 'block';
            document.querySelector('.setup-actions').style.display = 'none';
        }

        function startGame() {
            // Reorganize players array based on order
            gameState.players = gameState.playerOrder;
            gameState.phase = 'playing';
            gameState.currentPlayerIndex = 0;

            // Hide setup, show game
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';

            // Render game UI
            renderBoard();
            renderPlayersPanel();
            updateTurnDisplay();
            
            showNotification(`${gameState.players[0].icon} ${gameState.players[0].name} come√ßa!`);
        }

        // ========== BOARD RENDERING ==========
        function renderBoard() {
            const boardDiv = document.getElementById('visualBoard');
            
            // Definir layout do tabuleiro (36 casas ORIGINAIS TUGLORDS VALIDADAS) - SENTIDO HOR√ÅRIO CORRETO
            // Todas as casas validadas contra o arquivo original v14.0
            const boardLayout = [
                // Posi√ß√£o 0: Canto inferior direito (PARTIDA)
                { pos: 0, name: 'Partida', icon: 'üèÅ', type: 'corner', price: null, owner: undefined },
                
                // Posi√ß√µes 1-8: Lado INFERIOR (da direita para ESQUERDA) - HOR√ÅRIO
                { pos: 1, name: 'Porto de Suape', icon: '‚öì', type: 'property', price: 180, rent: [2, 10, 30, 90, 160, 250], owner: undefined, stocks: 0 },
                { pos: 2, name: 'Bolsa de Valores', icon: 'üìà', type: 'stock_exchange', price: null, owner: undefined },
                { pos: 3, name: 'Porto de Itaqui', icon: '‚öì', type: 'property', price: 260, rent: [4, 20, 60, 180, 320, 450], owner: undefined, stocks: 0 },
                { pos: 4, name: 'Oficina KATEC', icon: 'üîß', type: 'workshop', price: 150, serviceFee: 60, certificate: 'cert_katec', owner: undefined },
                { pos: 5, name: 'Treinamento: Combate a Inc√™ndio', icon: 'üî•', type: 'training', price: 50, certificate: 'fire' },
                { pos: 6, name: 'Porto de Paranagu√°', icon: 'üö¢', type: 'property', price: 200, rent: [6, 30, 90, 270, 400, 550], owner: undefined, stocks: 0 },
                { pos: 7, name: 'Comprar Rebocador Portu√°rio', icon: '‚öì+', type: 'tug_purchase', price: 200, tugType: 'port' },
                { pos: 8, name: 'Imposto', icon: 'üí∏', type: 'tax', price: 200 },
                
                // Posi√ß√£o 9: Canto inferior esquerdo (SORTE) - N√ÉO √â CORNER, √â LUCK!
                { pos: 9, name: 'Sorte', icon: 'üçÄ', type: 'luck', price: null },
                
                // Posi√ß√µes 10-17: Lado ESQUERDO (de baixo para CIMA) - HOR√ÅRIO
                { pos: 10, name: 'Porto do Rio Grande', icon: 'üö¢', type: 'property', price: 100, rent: [6, 30, 90, 270, 400, 550], owner: undefined, stocks: 0 },
                { pos: 11, name: 'Treinamento: Homem ao Mar', icon: 'üèä', type: 'training', price: 50, certificate: 'rescue' },
                { pos: 12, name: 'Servi√ßos de Combust√≠vel', icon: '‚õΩ', type: 'service', price: 150, owner: undefined },
                { pos: 13, name: 'Oficina MTU', icon: '‚öôÔ∏è', type: 'workshop', price: 150, serviceFee: 50, certificate: 'cert_mtu', owner: undefined },
                { pos: 14, name: 'Porto de Itagua√≠', icon: 'üö¢', type: 'property', price: 220, rent: [8, 40, 100, 300, 450, 600], owner: undefined, stocks: 0 },
                { pos: 15, name: 'Universidade do Mar', icon: 'üéì', type: 'university', price: null },
                { pos: 16, name: 'Porto de Santos', icon: 'üèóÔ∏è', type: 'property', price: 340, rent: [10, 50, 150, 450, 625, 750], owner: undefined, stocks: 0 },
                { pos: 17, name: 'Sorte', icon: 'üçÄ', type: 'luck', price: null },
                
                // Posi√ß√£o 18: Canto superior esquerdo (CERTIFICADO TUGLORD)
                { pos: 18, name: 'Certificado TugLord', icon: 'üéñÔ∏è', type: 'tuglord_certificate', price: null },
                
                // Posi√ß√µes 19-26: Lado SUPERIOR (da esquerda para DIREITA) - HOR√ÅRIO
                { pos: 19, name: 'Porto de Vit√≥ria', icon: 'üèóÔ∏è', type: 'property', price: 140, rent: [10, 50, 150, 450, 625, 750], owner: undefined, stocks: 0 },
                { pos: 20, name: 'Treinamento: Colis√£o', icon: 'üí•', type: 'training', price: 75, certificate: 'collision' },
                { pos: 21, name: 'Porto de Manaus', icon: 'üèóÔ∏è', type: 'property', price: 160, rent: [12, 60, 180, 500, 700, 900], owner: undefined, stocks: 0 },
                { pos: 22, name: 'Oficina SCHOTTEK Propulsores', icon: 'üî©', type: 'workshop', price: 150, serviceFee: 40, certificate: 'cert_schottek', owner: undefined },
                { pos: 23, name: 'Porto Central', icon: 'üìú', type: 'contract', price: 1000 },
                { pos: 24, name: 'Estaleiro', icon: 'üè≠', type: 'service', price: 150, repairCost: 75, tuglordBuildCost: 750, owner: undefined },
                { pos: 25, name: 'Sorte', icon: 'üçÄ', type: 'luck', price: null },
                { pos: 26, name: 'Comprar Rebocador Oce√¢nico', icon: 'œÅœÖ', type: 'tug_purchase', price: 500, tugType: 'ocean' },
                
                // Posi√ß√£o 27: Canto superior direito (BANCO) - N√ÉO √â CORNER, √â BANK!
                { pos: 27, name: 'Banco', icon: 'üèõÔ∏è', type: 'bank', price: null },
                
                // Posi√ß√µes 28-35: Lado DIREITO (de cima para BAIXO) - HOR√ÅRIO
                { pos: 28, name: 'Porto de Aratu', icon: 'üåä', type: 'property', price: 180, rent: [14, 70, 200, 550, 750, 950], owner: undefined, stocks: 0 },
                { pos: 29, name: 'Treinamento: Abandono de Navio', icon: 'üèÉ‚Äç‚ôÇÔ∏è', type: 'training', price: 75, certificate: 'abandon' },
                { pos: 30, name: 'Porto do A√ßu', icon: 'üåä', type: 'property', price: 200, rent: [16, 80, 220, 600, 800, 1000], owner: undefined, stocks: 0 },
                { pos: 31, name: 'Evento Oce√¢nico', icon: 'üåä', type: 'ocean_event', price: null },
                { pos: 32, name: 'Sorte', icon: 'üçÄ', type: 'luck', price: null },
                { pos: 33, name: 'Zona de Manobra Portu√°ria', icon: 'üîÑ', type: 'maneuver', price: null },
                { pos: 34, name: 'Porto de Itapo√°', icon: 'üì¶', type: 'property', price: 220, rent: [18, 90, 250, 700, 875, 1050], owner: undefined, stocks: 0 },
                { pos: 35, name: 'Porto de Imbituba', icon: 'üì¶', type: 'property', price: 240, rent: [20, 100, 300, 750, 925, 1100], owner: undefined, stocks: 0 },
            ];

            // Update gameState houses with full board
            gameState.houses = boardLayout;

            // Create board HTML - LAYOUT HOR√ÅRIO CORRETO (36 casas = 4 corners + 8 por lado)
            let boardHTML = '<div class="board-game">';
            
            // Canto inferior direito (PARTIDA - posi√ß√£o 0)
            boardHTML += '<div class="board-corner" style="grid-column: 3; grid-row: 3;">';
            boardHTML += '<span>üèÅ</span>';
            boardHTML += '<div class="board-corner-label">PARTIDA</div>';
            boardHTML += '</div>';
            
            // Lado INFERIOR (posi√ß√µes 1-8) - da DIREITA para ESQUERDA (hor√°rio)
            boardHTML += '<div class="board-side bottom" style="grid-column: 2; grid-row: 3;">';
            for (let i = 8; i >= 1; i--) { // Invertido para mostrar da direita pra esquerda
                const house = boardLayout[i];
                boardHTML += `<div class="board-house" data-position="${house.pos}" onclick="selectHouse(${house.pos})">`;
                boardHTML += `<div class="house-icon">${house.icon}</div>`;
                boardHTML += `<div class="house-name">${house.name}</div>`;
                if (house.price) {
                    boardHTML += `<div class="house-price">R$ ${house.price}</div>`;
                }
                boardHTML += '<div class="house-players"></div>';
                boardHTML += '</div>';
            }
            boardHTML += '</div>';
            
            // Canto inferior esquerdo (SORTE - posi√ß√£o 9) - Casa normal, n√£o corner visual
            boardHTML += '<div class="board-corner" style="grid-column: 1; grid-row: 3;">';
            boardHTML += '<span>üçÄ</span>';
            boardHTML += '<div class="board-corner-label">SORTE</div>';
            boardHTML += '<div class="house-players" style="position: absolute; bottom: 0.25rem; display: flex; gap: 0.125rem; flex-wrap: wrap; justify-content: center;"></div>';
            boardHTML += '</div>';
            
            // Lado ESQUERDO (posi√ß√µes 10-17) - de BAIXO para CIMA (hor√°rio)
            boardHTML += '<div class="board-side left" style="grid-column: 1; grid-row: 2;">';
            for (let i = 17; i >= 10; i--) { // Invertido para mostrar de baixo pra cima
                const house = boardLayout[i];
                boardHTML += `<div class="board-house" data-position="${house.pos}" onclick="selectHouse(${house.pos})">`;
                boardHTML += `<div class="house-icon">${house.icon}</div>`;
                boardHTML += `<div class="house-name">${house.name}</div>`;
                if (house.price) {
                    boardHTML += `<div class="house-price">R$ ${house.price}</div>`;
                }
                boardHTML += '<div class="house-players"></div>';
                boardHTML += '</div>';
            }
            boardHTML += '</div>';
            
            // Canto superior esquerdo (CERTIFICADO TUGLORD - posi√ß√£o 18)
            boardHTML += '<div class="board-corner" style="grid-column: 1; grid-row: 1;">';
            boardHTML += '<span>üéñÔ∏è</span>';
            boardHTML += '<div class="board-corner-label">TUGLORD</div>';
            boardHTML += '<div class="house-players" style="position: absolute; bottom: 0.25rem; display: flex; gap: 0.125rem; flex-wrap: wrap; justify-content: center;"></div>';
            boardHTML += '</div>';
            
            // Lado SUPERIOR (posi√ß√µes 19-26) - da ESQUERDA para DIREITA (hor√°rio)
            boardHTML += '<div class="board-side top" style="grid-column: 2; grid-row: 1;">';
            for (let i = 19; i <= 26; i++) { // Normal, da esquerda pra direita
                const house = boardLayout[i];
                boardHTML += `<div class="board-house" data-position="${house.pos}" onclick="selectHouse(${house.pos})">`;
                boardHTML += `<div class="house-icon">${house.icon}</div>`;
                boardHTML += `<div class="house-name">${house.name}</div>`;
                if (house.price) {
                    boardHTML += `<div class="house-price">R$ ${house.price}</div>`;
                }
                boardHTML += '<div class="house-players"></div>';
                boardHTML += '</div>';
            }
            boardHTML += '</div>';
            
            // Canto superior direito (BANCO - posi√ß√£o 27) - Casa especial, n√£o corner visual tradicional
            boardHTML += '<div class="board-corner" style="grid-column: 3; grid-row: 1;">';
            boardHTML += '<span>üèõÔ∏è</span>';
            boardHTML += '<div class="board-corner-label">BANCO</div>';
            boardHTML += '<div class="house-players" style="position: absolute; bottom: 0.25rem; display: flex; gap: 0.125rem; flex-wrap: wrap; justify-content: center;"></div>';
            boardHTML += '</div>';
            
            // Lado DIREITO (posi√ß√µes 28-35) - de CIMA para BAIXO (hor√°rio)
            boardHTML += '<div class="board-side right" style="grid-column: 3; grid-row: 2;">';
            for (let i = 28; i <= 35; i++) { // Normal, de cima pra baixo
                const house = boardLayout[i];
                boardHTML += `<div class="board-house" data-position="${house.pos}" onclick="selectHouse(${house.pos})">`;
                boardHTML += `<div class="house-icon">${house.icon}</div>`;
                boardHTML += `<div class="house-name">${house.name}</div>`;
                if (house.price) {
                    boardHTML += `<div class="house-price">R$ ${house.price}</div>`;
                }
                boardHTML += '<div class="house-players"></div>';
                boardHTML += '</div>';
            }
            boardHTML += '</div>';
            
            // Centro
            boardHTML += '<div class="board-center">';
            boardHTML += '<div class="board-center-icon">‚öì</div>';
            boardHTML += '<h3>TUGLORDS</h3>';
            boardHTML += '<p style="font-size: 0.75rem; color: #94a3b8; margin: 0;">Dom√≠nio Portu√°rio</p>';
            boardHTML += '</div>';
            
            boardHTML += '</div>';
            
            boardDiv.innerHTML = boardHTML;
            
            // Update player positions
            updatePlayerPositions();
        }

        function updatePlayerPositions() {
            // Clear all player pawns
            document.querySelectorAll('.house-players').forEach(el => el.innerHTML = '');
            
            // Remove active class from all houses
            document.querySelectorAll('.board-house').forEach(house => house.classList.remove('active'));
            document.querySelectorAll('.board-corner').forEach(corner => corner.classList.remove('active'));
            
            // ========== ADICIONAR INDICADORES DE OWNERSHIP ==========
            document.querySelectorAll('.board-house').forEach(houseEl => {
                const position = parseInt(houseEl.getAttribute('data-position'));
                const house = gameState.houses[position];
                
                // Remover ownership anterior
                const oldOwnerBar = houseEl.querySelector('.owner-bar');
                if (oldOwnerBar) oldOwnerBar.remove();
                
                // Se tem dono, adicionar indicador
                if (house && house.owner !== undefined) {
                    const owner = gameState.players.find(p => p.id === house.owner);
                    if (owner) {
                        const ownerBar = document.createElement('div');
                        ownerBar.className = 'owner-bar';
                        ownerBar.style.cssText = `
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            height: 4px;
                            background: ${owner.color};
                            box-shadow: 0 0 8px ${owner.color};
                        `;
                        ownerBar.title = `Dono: ${owner.name}`;
                        houseEl.style.position = 'relative';
                        houseEl.insertBefore(ownerBar, houseEl.firstChild);
                    }
                }
            });
            
            // Place players on their positions
            gameState.players.forEach(player => {
                // Buscar elemento por data-position OU pelo .house-players direto nos corners
                let houseEl = document.querySelector(`[data-position="${player.position}"] .house-players`);
                
                // Se n√£o encontrou (√© um corner especial), buscar no corner
                if (!houseEl) {
                    // Para posi√ß√µes 9, 18, 27 que s√£o corners com .house-players
                    const allHousePlayers = document.querySelectorAll('.house-players');
                    allHousePlayers.forEach(el => {
                        const parent = el.closest('.board-corner');
                        if (parent) {
                            // Detectar qual corner √© baseado na posi√ß√£o do grid
                            const gridCol = parent.style.gridColumn;
                            const gridRow = parent.style.gridRow;
                            
                            // Posi√ß√£o 9: grid-column: 1; grid-row: 3
                            if (gridCol === '1' && gridRow === '3' && player.position === 9) {
                                houseEl = el;
                            }
                            // Posi√ß√£o 18: grid-column: 1; grid-row: 1
                            if (gridCol === '1' && gridRow === '1' && player.position === 18) {
                                houseEl = el;
                            }
                            // Posi√ß√£o 27: grid-column: 3; grid-row: 1
                            if (gridCol === '3' && gridRow === '1' && player.position === 27) {
                                houseEl = el;
                            }
                        }
                    });
                }
                
                if (houseEl) {
                    const pawn = document.createElement('div');
                    pawn.className = 'player-pawn';
                    pawn.style.background = player.color;
                    pawn.textContent = player.icon;
                    pawn.title = player.name;
                    houseEl.appendChild(pawn);
                }
                
                // Highlight current player's position
                if (player === gameState.players[gameState.currentPlayerIndex]) {
                    const currentHouse = document.querySelector(`[data-position="${player.position}"]`);
                    if (currentHouse) {
                        currentHouse.classList.add('active');
                    } else {
                        // √â um corner especial, adicionar active no corner
                        const allCorners = document.querySelectorAll('.board-corner');
                        allCorners.forEach(corner => {
                            const gridCol = corner.style.gridColumn;
                            const gridRow = corner.style.gridRow;
                            if ((gridCol === '1' && gridRow === '3' && player.position === 9) ||
                                (gridCol === '1' && gridRow === '1' && player.position === 18) ||
                                (gridCol === '3' && gridRow === '1' && player.position === 27)) {
                                corner.classList.add('active');
                            }
                        });
                    }
                }
            });
        }

        function selectHouse(position) {
            const house = gameState.houses[position];
            if (house) {
                showNotification(`üìç ${house.name}`);
            }
        }

        // ========== GAME FUNCTIONS ==========
        function renderPlayersPanel() {
            const container = document.getElementById('playersContainer');
            container.innerHTML = gameState.players.map((player, index) => {
                // Calcular frota operacional
                const portTugsOperational = player.portTugs - player.dockedTugs.port;
                const oceanTugOperational = player.hasOceanTug && !player.dockedTugs.ocean;
                const tuglordOperational = player.hasTuglord && !player.dockedTugs.tuglord;
                
                // Lista de ativos
                let assetsList = '';
                if (player.properties.length > 0) {
                    assetsList += `<p class="text-sm text-slate-300" style="margin: 0.5rem 0;">
                        üì¶ <strong>Propriedades (${player.properties.length}):</strong><br>
                        <span style="color: #94a3b8; font-size: 0.85rem;">${player.properties.join(', ')}</span>
                    </p>`;
                }
                
                // Frota
                let fleetInfo = '';
                if (player.portTugs > 0 || player.hasOceanTug || player.hasTuglord) {
                    fleetInfo += `<p class="text-sm text-slate-300" style="margin: 0.5rem 0;">
                        ‚öì <strong>Frota:</strong><br>`;
                    
                    if (player.portTugs > 0) {
                        fleetInfo += `<span style="color: ${portTugsOperational > 0 ? '#22c55e' : '#ef4444'}; font-size: 0.85rem;">
                            ‚Ä¢ Portu√°rios: ${portTugsOperational}/${player.portTugs} operacionais
                        </span><br>`;
                    }
                    
                    if (player.hasOceanTug) {
                        fleetInfo += `<span style="color: ${oceanTugOperational ? '#22c55e' : '#ef4444'}; font-size: 0.85rem;">
                            ‚Ä¢ Oce√¢nico: ${oceanTugOperational ? 'Operacional' : 'Docado'}
                        </span><br>`;
                    }
                    
                    if (player.hasTuglord) {
                        fleetInfo += `<span style="color: ${tuglordOperational ? '#fbbf24' : '#ef4444'}; font-size: 0.85rem;">
                            ‚Ä¢ Classe TugLord: ${tuglordOperational ? 'Operacional' : 'Docado'}
                        </span>`;
                    }
                    
                    fleetInfo += `</p>`;
                }
                
                // Certificados
                let certsInfo = '';
                if (player.certificates.length > 0) {
                    certsInfo += `<p class="text-sm text-slate-300" style="margin: 0.5rem 0;">
                        üéì <strong>Certificados (${player.certificates.length}):</strong><br>
                        <span style="color: #94a3b8; font-size: 0.85rem;">${player.certificates.join(', ')}</span>
                    </p>`;
                }
                
                const assetsContent = assetsList || fleetInfo || certsInfo 
                    ? assetsList + fleetInfo + certsInfo 
                    : '<p class="text-sm text-slate-400">Nenhum ativo ainda</p>';
                
                return `
                <div class="player-card ${index === gameState.currentPlayerIndex ? 'active' : ''}" 
                     style="border-left: 4px solid ${player.color};">
                    <div class="player-header">
                        <span class="player-name">${player.icon} ${player.name}</span>
                        <span class="player-money">R$ ${player.money.toLocaleString('pt-BR')}</span>
                    </div>
                    <div class="tabs-container">
                        <button class="tab-btn active" onclick="switchTab(this, 'fin-${player.id}')">Finan√ßas</button>
                        <button class="tab-btn" onclick="switchTab(this, 'assets-${player.id}')">Ativos</button>
                    </div>
                    <div class="tab-content active" id="fin-${player.id}">
                        <div class="badge">
                            <span class="dot" style="background: ${player.color};"></span>
                            <span>Posi√ß√£o: ${player.position}</span>
                        </div>
                    </div>
                    <div class="tab-content" id="assets-${player.id}">
                        ${assetsContent}
                    </div>
                </div>
            `;
            }).join('');
        }

        function updateTurnDisplay() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            document.getElementById('currentPlayerName').textContent = `${currentPlayer.icon} ${currentPlayer.name}`;
            document.getElementById('currentTurnPlayer').textContent = currentPlayer.name;
            document.getElementById('currentRound').textContent = `Rodada ${gameState.currentRound}`;
            
            // Reset dice display
            document.getElementById('diceDisplay').innerHTML = '‚öÄ ‚öÄ';
            
            // Reset dice button
            gameState.diceRolled = false;
            document.getElementById('rollDiceBtn').disabled = false;
            document.getElementById('rollDiceBtn').style.opacity = '1';
            document.getElementById('endTurnBtn').disabled = false;
        }

        function rollDice() {
            if (gameState.diceRolled) return;

            const diceDisplay = document.getElementById('diceDisplay');
            const dice = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
            
            let rolls = 0;
            const interval = setInterval(() => {
                const rand1 = Math.floor(Math.random() * 6);
                const rand2 = Math.floor(Math.random() * 6);
                diceDisplay.innerHTML = `${dice[rand1]} ${dice[rand2]}`;
                rolls++;
                
                if (rolls > 12) {
                    clearInterval(interval);
                    const final1 = Math.floor(Math.random() * 6) + 1;
                    const final2 = Math.floor(Math.random() * 6) + 1;
                    const total = final1 + final2;
                    
                    diceDisplay.innerHTML = `
                        <div style="display: flex; gap: 0.5rem; align-items: center; justify-content: center; flex-wrap: wrap;">
                            <span>${dice[final1-1]}</span>
                            <span>${dice[final2-1]}</span>
                            <span style="font-size: 2rem; color: var(--accent-gold);">= ${total}</span>
                        </div>
                    `;
                    
                    console.log(`üé≤ Dados: ${final1} + ${final2} = ${total}`);
                    
                    // Move player
                    movePlayer(total);
                    
                    gameState.diceRolled = true;
                    document.getElementById('rollDiceBtn').disabled = true;
                    document.getElementById('rollDiceBtn').style.opacity = '0.5';
                }
            }, 100);
        }

        function movePlayer(spaces) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const startPosition = currentPlayer.position;
            let currentStep = 0;
            
            // Log inicial do movimento
            console.log(`üé≤ === MOVIMENTO DO JOGADOR ${currentPlayer.name} ===`);
            console.log(`   Dados rolados: ${spaces}`);
            console.log(`   Posi√ß√£o inicial: ${startPosition} (${gameState.houses[startPosition].name})`);
            console.log(`   Trajet√≥ria:`);
            
            // Desabilitar bot√µes durante anima√ß√£o
            document.getElementById('rollDiceBtn').disabled = true;
            document.getElementById('endTurnBtn').disabled = true;
            
            // Mostrar contador de movimento
            showNotification(`üé≤ Movendo ${spaces} casas...`);
            
            // Animar movimento casa por casa
            const moveInterval = setInterval(() => {
                if (currentStep >= spaces) {
                    clearInterval(moveInterval);
                    
                    // Movimento completo
                    const finalPosition = currentPlayer.position;
                    const house = gameState.houses[finalPosition];
                    
                    // Verifica√ß√£o: confirmar que moveu exatamente o n√∫mero de casas
                    const actualMoves = (finalPosition - startPosition + gameState.houses.length) % gameState.houses.length;
                    
                    console.log(`   Posi√ß√£o final: ${finalPosition} (${house.name})`);
                    console.log(`   ‚úì VERIFICA√á√ÉO: Moveu ${actualMoves} casas (esperado: ${spaces})`);
                    if (actualMoves === spaces) {
                        console.log(`   ‚úÖ Movimento correto!`);
                    } else {
                        console.log(`   ‚ùå ERRO: Movimento incorreto!`);
                    }
                    console.log(`üé≤ === FIM DO MOVIMENTO ===\n`);
                    
                    // Update position display
                    document.getElementById('currentHouseName').textContent = house.name;
                    
                    showNotification(`‚úÖ ${currentPlayer.icon} chegou em ${house.name}!`);
                    
                    // Reabilitar bot√£o de fim de turno
                    document.getElementById('endTurnBtn').disabled = false;
                    
                    // Show contextual actions
                    setTimeout(() => showContextualActions(house), 500);
                    
                    return;
                }
                
                // Move one house
                currentStep++;
                currentPlayer.position = (startPosition + currentStep) % gameState.houses.length;
                
                // Log cada passo
                const stepHouse = gameState.houses[currentPlayer.position];
                console.log(`   Passo ${currentStep}: Casa ${currentPlayer.position} (${stepHouse.name})`);
                
                // ========== PASSAGEM PELA PARTIDA ==========
                // Se passou pela Partida (casa 0) E n√£o √© a casa final
                if (currentPlayer.position === 0 && currentStep < spaces) {
                    currentPlayer.money += 200;
                    console.log(`   üí∞ PARTIDA: ${currentPlayer.name} recebeu R$200!`);
                    showNotification(`üèÅ ${currentPlayer.name} passou pela Partida! +R$200`);
                    
                    // Update players panel to show new money
                    renderPlayersPanel();
                }
                
                // Update visual
                updatePlayerPositions();
                
                // Show house name during movement
                document.getElementById('currentHouseName').textContent = `‚Üí ${stepHouse.name}`;
                
            }, 300); // 300ms por casa
            
            // Update players panel after movement
            setTimeout(() => {
                renderPlayersPanel();
            }, spaces * 300 + 500);
        }

        function showContextualActions(house) {
            const actionsDiv = document.getElementById('contextualActions');
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            let buttonsHTML = '';
            let autoAction = false; // Se true, executa a√ß√£o automaticamente
            
            // ========== PROPERTY (Porto) ==========
            if (house.type === 'property' && house.price) {
                const owner = house.owner !== undefined ? gameState.players.find(p => p.id === house.owner) : null;
                
                if (!owner) {
                    // Propriedade SEM DONO - Pode comprar
                    buttonsHTML += `
                        <button class="btn-primary" onclick="buyProperty(gameState.houses[${house.pos}])">
                            üè™ Comprar Porto<br><small>R$ ${house.price}</small>
                        </button>
                    `;
                } else if (owner.id === currentPlayer.id) {
                    // Propriedade PR√ìPRIA - Sem a√ß√£o
                    buttonsHTML += `<p style="color: #22c55e; font-weight: bold;">‚úÖ Voc√™ √© o dono deste porto!</p>`;
                } else {
                    // Propriedade DE OUTRO - Pagar aluguel
                    
                    // Verificar se deve pular aluguel (Evento Oce√¢nico)
                    if (currentPlayer.skipNextRent) {
                        buttonsHTML += `
                            <p style="color: #10b981; font-weight: bold;">
                                ‚õµ Vento Favor√°vel!<br>
                                <span style="font-size: 1.2rem;">Aluguel dispensado</span>
                            </p>
                        `;
                        currentPlayer.skipNextRent = false; // Reset flag
                        console.log(`   ‚õµ Aluguel PULADO devido a Evento Oce√¢nico!`);
                        showNotification(`‚õµ ${currentPlayer.name} n√£o paga aluguel! (Vento Favor√°vel)`);
                    } else {
                        // Pagar aluguel normalmente
                        const rent = calculateRent(house, owner);
                        buttonsHTML += `
                            <p style="color: #ef4444; font-weight: bold;">
                                üí∏ Pagar Aluguel para ${owner.name}<br>
                                <span style="font-size: 1.5rem;">R$ ${rent}</span>
                            </p>
                        `;
                        
                        // Auto-executar pagamento
                        autoAction = true;
                        setTimeout(() => {
                            handleMandatoryPayment(currentPlayer, rent, `Aluguel (${house.name})`, owner);
                            document.getElementById('contextualActions').style.display = 'none';
                        }, 1500);
                    }
                }
            }
            
            // ========== WORKSHOP (Oficina) ==========
            if (house.type === 'workshop' && house.price) {
                const owner = house.owner !== undefined ? gameState.players.find(p => p.id === house.owner) : null;
                
                if (!owner) {
                    // Oficina SEM DONO - Pode comprar
                    buttonsHTML += `
                        <button class="btn-primary" onclick="buyProperty(gameState.houses[${house.pos}])">
                            üîß Comprar Oficina<br><small>R$ ${house.price}</small>
                        </button>
                    `;
                } else if (owner.id === currentPlayer.id) {
                    // Oficina PR√ìPRIA - Receber certificado gr√°tis se n√£o tem
                    if (!currentPlayer.certificates.includes(house.certificate)) {
                        buttonsHTML += `
                            <button class="btn-primary" onclick="receiveCertificate('${house.certificate}', '${house.name}')">
                                üéì Receber Certificado Gr√°tis
                            </button>
                        `;
                    } else {
                        buttonsHTML += `<p style="color: #22c55e; font-weight: bold;">‚úÖ Sua oficina! Certificado j√° obtido.</p>`;
                    }
                } else {
                    // Oficina DE OUTRO - Pagar taxa de servi√ßo
                    const serviceFee = house.serviceFee;
                    buttonsHTML += `
                        <p style="color: #ef4444; font-weight: bold;">
                            üí∏ Taxa de Servi√ßo para ${owner.name}<br>
                            <span style="font-size: 1.5rem;">R$ ${serviceFee}</span>
                        </p>
                    `;
                    
                    // Auto-executar pagamento
                    autoAction = true;
                    setTimeout(() => {
                        handleMandatoryPayment(currentPlayer, serviceFee, `Taxa (${house.name})`, owner);
                        document.getElementById('contextualActions').style.display = 'none';
                    }, 1500);
                }
            }
            
            // ========== SERVICE (Combust√≠vel/Estaleiro) ==========
            if (house.type === 'service' && house.price) {
                const owner = house.owner !== undefined ? gameState.players.find(p => p.id === house.owner) : null;
                
                if (!owner) {
                    // Servi√ßo SEM DONO - Pode comprar
                    buttonsHTML += `
                        <button class="btn-primary" onclick="buyProperty(gameState.houses[${house.pos}])">
                            üè™ Comprar Servi√ßo<br><small>R$ ${house.price}</small>
                        </button>
                    `;
                } else if (owner.id === currentPlayer.id) {
                    // Servi√ßo PR√ìPRIO
                    buttonsHTML += `<p style="color: #22c55e; font-weight: bold;">‚úÖ Voc√™ √© o dono deste servi√ßo!</p>`;
                    
                    // Se √© estaleiro E dono E n√£o tem TugLord: pode comissionar
                    if (house.name.includes('Estaleiro') && !currentPlayer.hasTuglord && currentPlayer.money >= house.tuglordBuildCost) {
                        buttonsHTML += `
                            <button class="btn-primary" onclick="commissionTugLord(${house.tuglordBuildCost})">
                                ‚≠ê Comissionar Classe TugLord<br><small>R$ ${house.tuglordBuildCost}</small>
                            </button>
                        `;
                    }
                } else {
                    // Servi√ßo DE OUTRO - Sem taxa adicional (s√≥ ownership)
                    buttonsHTML += `<p style="color: #94a3b8;">Propriedade de ${owner.name}</p>`;
                }
                
                // ===== VERIFICAR DOCAGEM OBRIGAT√ìRIA (ESTALEIRO) =====
                if (house.name.includes('Estaleiro')) {
                    const operationalPortTugs = currentPlayer.portTugs - currentPlayer.dockedTugs.port;
                    const operationalOceanTug = currentPlayer.hasOceanTug && !currentPlayer.dockedTugs.ocean;
                    const operationalTuglord = currentPlayer.hasTuglord && !currentPlayer.dockedTugs.tuglord;
                    const hasOperationalTugs = operationalPortTugs > 0 || operationalOceanTug || operationalTuglord;
                    
                    if (hasOperationalTugs) {
                        // Docagem obrigat√≥ria - executar ap√≥s delay
                        autoAction = true;
                        setTimeout(() => {
                            handleShipyard(house);
                        }, 1500);
                    }
                }
            }
            
            // ========== TRAINING (Treinamento) ==========
            if (house.type === 'training' && house.price) {
                if (!currentPlayer.certificates.includes(house.certificate)) {
                    buttonsHTML += `
                        <button class="btn-primary" onclick="buyTraining('${house.name}', ${house.price}, '${house.certificate}')">
                            üéì Fazer Treinamento<br><small>R$ ${house.price}</small>
                        </button>
                    `;
                } else {
                    buttonsHTML += `<p style="color: #22c55e; font-weight: bold;">‚úÖ Certificado j√° obtido!</p>`;
                }
            }
            
            // ========== TUG PURCHASE (Comprar Rebocador) ==========
            if (house.type === 'tug_purchase' && house.price) {
                const tugTypeName = house.tugType === 'port' ? 'Portu√°rio' : 'Oce√¢nico';
                buttonsHTML += `
                    <button class="btn-primary" onclick="buyTug(gameState.houses[${house.pos}])">
                        ‚öì Comprar Rebocador ${tugTypeName}<br><small>R$ ${house.price}</small>
                    </button>
                `;
            }
            
            // ========== CONTRACTS ==========
            if (house.type === 'contract' && house.price) {
                buttonsHTML += `
                    <button class="btn-primary" onclick="executeContract('${house.name}', ${house.price})">
                        üìú Executar Contrato<br><small>Receba R$ ${house.price}</small>
                    </button>
                `;
            }
            
            if (house.type === 'ocean_contract' && house.reward) {
                buttonsHTML += `
                    <button class="btn-primary" onclick="executeContract('${house.name}', ${house.reward})">
                        üìù Executar Contrato Oce√¢nico<br><small>Receba R$ ${house.reward}</small>
                    </button>
                `;
            }
            
            // ========== OUTRAS CASAS (mant√©m como estava) ==========
            
            if (house.type === 'stock_exchange') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="openStockExchange()">
                        üìà Negociar A√ß√µes
                    </button>
                `;
            }
            
            if (house.type === 'university') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="visitUniversity()">
                        üéì Acessar Universidade
                    </button>
                `;
            }
            
            if (house.type === 'bank') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="showLoanOptions()">
                        üí∞ Terminal Banc√°rio
                    </button>
                `;
                setTimeout(() => {
                    openPanel('panelBank');
                }, 500);
            }
            
            if (house.type === 'tuglord_certificate') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="checkTugLordCertificate()">
                        üéñÔ∏è Verificar Certifica√ß√£o
                    </button>
                `;
            }
            
            if (house.type === 'luck') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="drawCard('luck')">
                        üçÄ Pegar Carta Sorte
                    </button>
                `;
            }
            
            if (house.type === 'tax' && house.price) {
                buttonsHTML += `
                    <button class="btn-primary" onclick="payTax(${house.price})">
                        üí∏ Pagar Imposto<br><small>R$ ${house.price}</small>
                    </button>
                `;
            }
            
            if (house.type === 'maneuver') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="performManeuver()">
                        üîÑ Executar Manobra
                    </button>
                `;
            }
            
            // ========== BANK (Banco) ==========
            if (house.type === 'bank') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="openBankTerminal()">
                        üè¶ Acessar Terminal Banc√°rio
                    </button>
                `;
            }
            
            // ========== STOCK EXCHANGE (Bolsa de Valores) ==========
            if (house.type === 'stock_exchange') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="openStockExchange()">
                        üìà Acessar Bolsa de Valores
                    </button>
                `;
            }
            
            // ========== OCEAN EVENT (Evento Oce√¢nico) ==========
            if (house.type === 'ocean_event') {
                buttonsHTML += `
                    <button class="btn-primary" onclick="triggerOceanEvent()">
                        üåä Enfrentar Evento Oce√¢nico
                    </button>
                `;
            }
            
            // Exibir a√ß√µes
            if (buttonsHTML && !autoAction) {
                actionsDiv.innerHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;">' + buttonsHTML + '</div>';
                actionsDiv.style.display = 'block';
            } else if (autoAction) {
                actionsDiv.innerHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;">' + buttonsHTML + '</div>';
                actionsDiv.style.display = 'block';
            } else {
                actionsDiv.style.display = 'none';
            }
        }

        // Action handlers
        function buyTraining(name, price, certificate) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üéì === COMPRA DE TREINAMENTO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Treinamento: ${name}`);
            console.log(`   Pre√ßo: R$${price}`);
            console.log(`   Certificado: ${certificate}`);
            
            if (currentPlayer.money < price) {
                showNotification('‚ùå Saldo insuficiente!');
                console.log(`   ‚ùå Compra CANCELADA: saldo insuficiente`);
                return;
            }
            
            // Debitar dinheiro ANTES do exame
            currentPlayer.money -= price;
            renderPlayersPanel();
            
            console.log(`   üí∞ Investimento de R$${price} realizado`);
            console.log(`   üéì Iniciando exame...`);
            
            // Esconder a√ß√µes contextuais
            document.getElementById('contextualActions').style.display = 'none';
            
            // Apresentar exame
            presentExam(certificate, name, false);
        }
        
        function presentExam(certificate, trainingName, isFree = false) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üìù === APRESENTANDO EXAME ===`);
            console.log(`   Certificado: ${certificate}`);
            console.log(`   Gratuito: ${isFree}`);
            
            // Buscar perguntas do certificado
            const questions = TRAINING_QUESTIONS[certificate];
            if (!questions || questions.length === 0) {
                console.log(`   ‚ùå ERRO: Sem perguntas para ${certificate}`);
                showNotification('‚ö†Ô∏è Exame indispon√≠vel!');
                return;
            }
            
            // Selecionar pergunta aleat√≥ria
            const exam = questions[Math.floor(Math.random() * questions.length)];
            
            // Embaralhar op√ß√µes
            const shuffledOptions = [...exam.options].sort(() => Math.random() - 0.5);
            
            console.log(`   Pergunta: ${exam.question}`);
            console.log(`   Resposta correta: ${exam.correct}`);
            
            // Criar modal de exame
            const modalTitle = isFree 
                ? `üéì Exame Gr√°tis - Universidade do Mar` 
                : `üéì Exame de ${trainingName}`;
            
            const modalBody = `
                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <p style="color: #94a3b8; font-size: 0.85rem; margin: 0;">
                        ${isFree ? '‚ú® Exame oferecido gratuitamente pela Universidade do Mar!' : '‚ö†Ô∏è Se errar, o investimento ser√° perdido!'}
                    </p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid #3b82f6; margin-bottom: 1.5rem;">
                    <p style="font-size: 1.1rem; font-weight: 600; color: #e0e0e0; margin: 0; line-height: 1.6;">
                        ${exam.question}
                    </p>
                </div>
                
                <div style="display: grid; gap: 0.75rem;">
                    ${shuffledOptions.map((option, index) => `
                        <button class="btn-secondary" 
                                onclick="handleExamAnswer('${option.replace(/'/g, "\\'")}', '${exam.correct.replace(/'/g, "\\'")}', '${certificate}', '${trainingName}', ${isFree})"
                                style="text-align: left; padding: 1rem; font-size: 0.95rem; transition: all 0.2s;">
                            <strong>${String.fromCharCode(65 + index)})</strong> ${option}
                        </button>
                    `).join('')}
                </div>
            `;
            
            showModal(modalTitle, modalBody, [], false); // Sem bot√µes de fechar
        }
        
        function handleExamAnswer(submittedAnswer, correctAnswer, certificate, certName, isFree) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`‚úÖ === AVALIA√á√ÉO DO EXAME ===`);
            console.log(`   Resposta submetida: ${submittedAnswer}`);
            console.log(`   Resposta correta: ${correctAnswer}`);
            
            // Fechar modal
            closeModal();
            
            if (submittedAnswer === correctAnswer) {
                // ACERTOU!
                currentPlayer.certificates.push(certificate);
                
                console.log(`   ‚úÖ APROVADO! Certificado ${certificate} obtido.`);
                console.log(`üéì === FIM DO EXAME ===\n`);
                
                showNotification(`‚úÖ Parab√©ns! Certificado de ${certName} obtido!`);
                
                // Efeito visual de sucesso
                setTimeout(() => {
                    showNotification(`üéñÔ∏è ${currentPlayer.name} est√° mais qualificado!`);
                }, 1500);
            } else {
                // ERROU!
                console.log(`   ‚ùå REPROVADO! Certificado N√ÉO obtido.`);
                
                if (isFree) {
                    console.log(`   ‚ÑπÔ∏è Exame era gratuito, sem perdas financeiras.`);
                    showNotification(`‚ùå Resposta incorreta! Tente novamente mais tarde.`);
                } else {
                    console.log(`   üí∏ Investimento perdido!`);
                    showNotification(`‚ùå Resposta incorreta! Investimento perdido.`);
                }
                
                console.log(`üéì === FIM DO EXAME ===\n`);
            }
            
            renderPlayersPanel();
        }
        
        function receiveCertificate(certificate, officeName) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üéì Recebendo certificado gr√°tis: ${certificate} de ${officeName}`);
            
            if (!currentPlayer.certificates.includes(certificate)) {
                currentPlayer.certificates.push(certificate);
                showNotification(`‚úÖ Certificado ${certificate} recebido gratuitamente!`);
                renderPlayersPanel();
            } else {
                showNotification('‚ö†Ô∏è Voc√™ j√° possui este certificado!');
            }
            
            document.getElementById('contextualActions').style.display = 'none';
        }
        
        function commissionTugLord(cost) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`‚≠ê === COMISSIONAMENTO TUGLORD ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Custo: R$${cost}`);
            
            if (currentPlayer.money < cost) {
                showNotification('‚ùå Saldo insuficiente!');
                console.log(`   ‚ùå Comissionamento CANCELADO: saldo insuficiente`);
                return;
            }
            
            if (currentPlayer.hasTuglord) {
                showNotification('‚ö†Ô∏è Voc√™ j√° possui um Classe TugLord!');
                console.log(`   ‚ùå Comissionamento CANCELADO: j√° possui TugLord`);
                return;
            }
            
            // Debitar dinheiro
            currentPlayer.money -= cost;
            
            // Comissionar TugLord
            currentPlayer.hasTuglord = true;
            
            console.log(`   ‚úÖ Classe TugLord comissionado!`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`‚≠ê === FIM DO COMISSIONAMENTO ===\n`);
            
            showNotification(`‚≠ê Classe TugLord comissionado com sucesso!`);
            renderPlayersPanel();
            document.getElementById('contextualActions').style.display = 'none';
        }

        function executeContract(name, amount) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üìú === EXECU√á√ÉO DE CONTRATO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Contrato: ${name}`);
            console.log(`   Recompensa: R$${amount}`);
            
            currentPlayer.money += amount;
            
            console.log(`   ‚úÖ Contrato executado!`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üìú === FIM DO CONTRATO ===\n`);
            
            showNotification(`‚úÖ ${name} executado! +R$ ${amount}`);
            renderPlayersPanel();
            document.getElementById('contextualActions').style.display = 'none';
        }

        function openStockExchange() {
            showNotification('üìà Bolsa de Valores - Sprint 3');
            document.getElementById('contextualActions').style.display = 'none';
        }

        function visitUniversity() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üè´ === UNIVERSIDADE DO MAR ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Certificados atuais: ${currentPlayer.certificates.join(', ') || 'Nenhum'}`);
            
            // Certificados de treinamento dispon√≠veis
            const trainingCerts = ['fire', 'rescue', 'collision', 'abandon'];
            
            // Identificar certificados faltantes
            const missingCerts = trainingCerts.filter(cert => !currentPlayer.certificates.includes(cert));
            
            console.log(`   Certificados faltantes: ${missingCerts.join(', ') || 'Nenhum'}`);
            
            if (missingCerts.length === 0) {
                console.log(`   ‚úÖ Jogador j√° possui todos os certificados de treinamento!`);
                console.log(`üè´ === FIM DA UNIVERSIDADE ===\n`);
                
                showNotification('‚ú® Parab√©ns! Voc√™ j√° possui todos os certificados de treinamento!');
                document.getElementById('contextualActions').style.display = 'none';
                return;
            }
            
            // Selecionar certificado faltante aleatoriamente
            const selectedCert = missingCerts[Math.floor(Math.random() * missingCerts.length)];
            
            // Mapear certificado para nome do treinamento
            const certNames = {
                fire: 'Combate a Inc√™ndio',
                rescue: 'Homem ao Mar',
                collision: 'Colis√£o',
                abandon: 'Abandono de Navio'
            };
            
            const trainingName = certNames[selectedCert];
            
            console.log(`   üéØ Certificado selecionado: ${selectedCert} (${trainingName})`);
            console.log(`   üéì Oferecendo exame gr√°tis...`);
            console.log(`üè´ === INICIANDO EXAME ===\n`);
            
            // Esconder a√ß√µes contextuais
            document.getElementById('contextualActions').style.display = 'none';
            
            // Apresentar exame GR√ÅTIS
            presentExam(selectedCert, trainingName, true);
        }

        function checkTugLordCertificate() {
            showNotification('üéñÔ∏è Certificado TugLord - Sprint 4');
            document.getElementById('contextualActions').style.display = 'none';
        }

        function payTax(amount) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üí∏ === PAGAMENTO DE IMPOSTO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Valor: R$${amount}`);
            
            handleMandatoryPayment(currentPlayer, amount, "Imposto");
            
            console.log(`üí∏ === FIM DO IMPOSTO ===\n`);
            
            document.getElementById('contextualActions').style.display = 'none';
        }

        function performManeuver() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üîÑ === ZONA DE MANOBRA PORTU√ÅRIA ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            
            // Calcular rebocadores operacionais do jogador atual
            const playerPortTugs = currentPlayer.portTugs - currentPlayer.dockedTugs.port;
            const playerOceanTug = currentPlayer.hasOceanTug && !currentPlayer.dockedTugs.ocean;
            const playerTuglord = currentPlayer.hasTuglord && !currentPlayer.dockedTugs.tuglord;
            const playerTotalTugs = playerPortTugs + (playerOceanTug ? 1 : 0) + (playerTuglord ? 1 : 0);
            
            console.log(`   Rebocadores do jogador: ${playerTotalTugs}`);
            
            if (playerTotalTugs === 0) {
                // SEM REBOCADORES = SEM PENALIDADE
                console.log(`   ‚úÖ Sem rebocadores, sem penalidade!`);
                console.log(`üîÑ === FIM DA ZONA DE MANOBRA ===\n`);
                
                showNotification('‚úÖ Sem rebocadores, sem penalidade de manobra!');
                document.getElementById('contextualActions').style.display = 'none';
                return;
            }
            
            // Contar ADVERS√ÅRIOS com rebocadores operacionais
            const opponentsWithTugs = gameState.players.filter(opponent => {
                if (opponent.id === currentPlayer.id) return false; // Excluir pr√≥prio jogador
                
                const oppPortTugs = opponent.portTugs - opponent.dockedTugs.port;
                const oppOceanTug = opponent.hasOceanTug && !opponent.dockedTugs.ocean;
                const oppTuglord = opponent.hasTuglord && !opponent.dockedTugs.tuglord;
                const oppTotalTugs = oppPortTugs + (oppOceanTug ? 1 : 0) + (oppTuglord ? 1 : 0);
                
                return oppTotalTugs > 0;
            });
            
            const opponentsCount = opponentsWithTugs.length;
            const penalty = opponentsCount * 100;
            
            console.log(`   Advers√°rios com rebocadores: ${opponentsCount}`);
            console.log(`   Penalidade: R$${penalty}`);
            
            if (opponentsCount === 0) {
                console.log(`   ‚úÖ Nenhum advers√°rio com rebocadores!`);
                console.log(`üîÑ === FIM DA ZONA DE MANOBRA ===\n`);
                
                showNotification('‚úÖ Nenhum advers√°rio com rebocadores. Sem penalidade!');
                document.getElementById('contextualActions').style.display = 'none';
                return;
            }
            
            // APLICAR PENALIDADE
            console.log(`   üí∏ Aplicando penalidade de arrendamento...`);
            
            handleMandatoryPayment(currentPlayer, penalty, "Arrendamento (Zona de Manobra)");
            
            console.log(`üîÑ === FIM DA ZONA DE MANOBRA ===\n`);
            
            showNotification(`üîÑ Penalidade de manobra: R$${penalty} (${opponentsCount} advers√°rio${opponentsCount > 1 ? 's' : ''} com rebocadores)`);
            
            document.getElementById('contextualActions').style.display = 'none';
        }

        // ========== BOLSA DE VALORES ==========
        function openStockExchange() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üìà === BOLSA DE VALORES ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Saldo: R$${currentPlayer.money}`);
            
            // Listar propriedades dispon√≠veis para comprar a√ß√µes
            const availableProperties = gameState.houses.filter(h => 
                h.type === 'property' && 
                h.owner !== undefined && 
                h.owner !== currentPlayer.id &&
                h.stocks < 5 // M√°ximo 5 a√ß√µes por propriedade
            );
            
            // Listar a√ß√µes do jogador
            const playerStocksList = Object.keys(currentPlayer.stocks).map(propName => {
                const quantity = currentPlayer.stocks[propName];
                const property = gameState.houses.find(h => h.name === propName);
                const dividendValue = Math.floor(property.rent[0] * 0.5);
                
                return {
                    name: propName,
                    quantity: quantity,
                    dividend: dividendValue,
                    totalDividend: dividendValue * quantity
                };
            });
            
            const totalDividends = playerStocksList.reduce((sum, stock) => sum + stock.totalDividend, 0);
            
            console.log(`   Propriedades dispon√≠veis: ${availableProperties.length}`);
            console.log(`   A√ß√µes do jogador: ${playerStocksList.length}`);
            console.log(`   Dividendos totais: R$${totalDividends}`);
            
            const modalBody = `
                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border-left: 4px solid #3b82f6;">
                    <p style="color: #60a5fa; font-weight: 600; margin: 0;">
                        üí∞ Saldo: R$${currentPlayer.money}
                    </p>
                    <p style="color: #94a3b8; font-size: 0.85rem; margin: 0.5rem 0 0 0;">
                        Suas a√ß√µes: ${playerStocksList.length} | Dividendos: R$${totalDividends}/turno
                    </p>
                </div>
                
                ${playerStocksList.length > 0 ? `
                <!-- SUAS A√á√ïES -->
                <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <p style="color: #22c55e; font-weight: 600; margin: 0 0 0.75rem 0;">
                        üìä Suas A√ß√µes (Dividendos por turno)
                    </p>
                    <div style="display: grid; gap: 0.5rem;">
                        ${playerStocksList.map(stock => `
                            <div style="background: rgba(255, 255, 255, 0.05); padding: 0.75rem; border-radius: 0.5rem;">
                                <p style="color: #e0e0e0; margin: 0; font-size: 0.9rem;">
                                    ${stock.name}
                                </p>
                                <p style="color: #94a3b8; margin: 0.25rem 0 0 0; font-size: 0.85rem;">
                                    ${stock.quantity}√ó a√ß√µes | R$${stock.dividend} cada = R$${stock.totalDividend}/turno
                                </p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${availableProperties.length > 0 ? `
                <!-- COMPRAR A√á√ïES -->
                <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <p style="color: #e0e0e0; font-weight: 600; margin: 0 0 0.75rem 0;">
                        üõí Comprar A√ß√µes (30% do pre√ßo)
                    </p>
                    <div style="display: grid; gap: 0.5rem; max-height: 200px; overflow-y: auto;">
                        ${availableProperties.map(prop => {
                            const stockPrice = Math.floor(prop.price * 0.3);
                            const owner = gameState.players.find(p => p.id === prop.owner);
                            const stocksRemaining = 5 - prop.stocks;
                            const dividend = Math.floor(prop.rent[0] * 0.5);
                            
                            return `
                                <button class="btn-secondary" 
                                        onclick="buyStock('${prop.name.replace(/'/g, "\\'")}', ${stockPrice})" 
                                        style="text-align: left; padding: 0.75rem; font-size: 0.85rem;">
                                    ${prop.name}<br>
                                    <small style="color: #94a3b8;">
                                        R$${stockPrice} | Dono: ${owner.name} | ${stocksRemaining} dispon√≠veis | Div: R$${dividend}
                                    </small>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
                ` : `
                <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <p style="color: #f87171; margin: 0; text-align: center;">
                        üì≠ Nenhuma a√ß√£o dispon√≠vel para compra no momento.
                    </p>
                </div>
                `}
                
                <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <p style="color: #fbbf24; font-size: 0.85rem; margin: 0;">
                        ‚ÑπÔ∏è A√ß√µes geram dividendos autom√°ticos a cada turno do dono da propriedade.
                    </p>
                </div>
                
                <button class="btn-primary" onclick="closeModal()" style="width: 100%;">
                    ‚úÖ Fechar Bolsa
                </button>
            `;
            
            showModal('üìà Bolsa de Valores', modalBody, [], false);
        }
        
        function buyStock(propertyName, stockPrice) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const property = gameState.houses.find(h => h.name === propertyName);
            
            console.log(`üìä === COMPRA DE A√á√ÉO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Propriedade: ${propertyName}`);
            console.log(`   Pre√ßo da a√ß√£o: R$${stockPrice}`);
            
            // Verifica√ß√µes
            if (currentPlayer.money < stockPrice) {
                console.log(`   ‚ùå Saldo insuficiente!`);
                showNotification('‚ùå Saldo insuficiente!');
                return;
            }
            
            if (property.stocks >= 5) {
                console.log(`   ‚ùå Limite de a√ß√µes atingido!`);
                showNotification('‚ùå Esta propriedade j√° atingiu o limite de 5 a√ß√µes!');
                return;
            }
            
            if (property.owner === currentPlayer.id) {
                console.log(`   ‚ùå N√£o pode comprar a√ß√µes da pr√≥pria propriedade!`);
                showNotification('‚ùå Voc√™ n√£o pode comprar a√ß√µes da sua pr√≥pria propriedade!');
                return;
            }
            
            // Processar compra
            currentPlayer.money -= stockPrice;
            
            // Adicionar a√ß√£o ao jogador
            if (!currentPlayer.stocks[propertyName]) {
                currentPlayer.stocks[propertyName] = 0;
            }
            currentPlayer.stocks[propertyName]++;
            
            // Incrementar a√ß√µes vendidas da propriedade
            property.stocks++;
            
            // Dono da propriedade recebe o dinheiro
            const owner = gameState.players.find(p => p.id === property.owner);
            owner.money += stockPrice;
            
            const dividend = Math.floor(property.rent[0] * 0.5);
            
            console.log(`   ‚úÖ A√ß√£o comprada!`);
            console.log(`   R$${stockPrice} transferido para ${owner.name}`);
            console.log(`   Dividendo: R$${dividend}/turno`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üìä === FIM DA COMPRA ===\n`);
            
            showNotification(`üìä A√ß√£o de ${propertyName} comprada! Dividendo: R$${dividend}/turno`);
            
            renderPlayersPanel();
            closeModal();
            
            // Reabrir bolsa atualizada
            setTimeout(() => openStockExchange(), 300);
        }
        
        function payDividends(propertyOwner) {
            console.log(`üí∞ === PAGAMENTO DE DIVIDENDOS ===`);
            console.log(`   Dono da propriedade: ${propertyOwner.name}`);
            
            let totalPaid = 0;
            
            // Para cada acionista, pagar dividendos das propriedades do dono atual
            gameState.players.forEach(player => {
                if (player.id === propertyOwner.id) return; // Pular o pr√≥prio dono
                if (player.isEliminated) return; // Pular eliminados
                
                // Verificar propriedades do dono atual que o jogador tem a√ß√µes
                propertyOwner.properties.forEach(propName => {
                    if (player.stocks[propName]) {
                        const quantity = player.stocks[propName];
                        const property = gameState.houses.find(h => h.name === propName);
                        const dividendPerStock = Math.floor(property.rent[0] * 0.5);
                        const totalDividend = dividendPerStock * quantity;
                        
                        // Transferir dividendo
                        propertyOwner.money -= totalDividend;
                        player.money += totalDividend;
                        
                        totalPaid += totalDividend;
                        
                        console.log(`   üí∏ ${player.name} recebeu R$${totalDividend} (${quantity}√ó a√ß√µes de ${propName})`);
                    }
                });
            });
            
            if (totalPaid > 0) {
                console.log(`   ‚úÖ Total pago em dividendos: R$${totalPaid}`);
                showNotification(`üí∞ ${propertyOwner.name} pagou R$${totalPaid} em dividendos!`);
            }
            
            console.log(`üí∞ === FIM DOS DIVIDENDOS ===\n`);
        }

        // ========== SISTEMA BANC√ÅRIO ==========
        function openBankTerminal() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üè¶ === TERMINAL BANC√ÅRIO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Saldo: R$${currentPlayer.money}`);
            console.log(`   Empr√©stimos ativos: ${currentPlayer.loans.length}`);
            
            const modalBody = `
                <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; border-left: 4px solid #3b82f6;">
                    <p style="color: #60a5fa; font-weight: 600; margin: 0;">
                        üí∞ Saldo Atual: R$${currentPlayer.money}
                    </p>
                    <p style="color: #94a3b8; font-size: 0.85rem; margin: 0.5rem 0 0 0;">
                        Empr√©stimos ativos: ${currentPlayer.loans.length}
                    </p>
                </div>
                
                <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                    <!-- EMPR√âSTIMOS -->
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                        <p style="color: #e0e0e0; font-weight: 600; margin: 0 0 0.75rem 0;">
                            üìã Empr√©stimos Dispon√≠veis
                        </p>
                        <div style="display: grid; gap: 0.5rem;">
                            <button class="btn-secondary" onclick="takeLoan(500)" style="text-align: left; padding: 0.75rem;">
                                üíµ R$500 ‚Üí Pagar R$550 (juros 10%)
                            </button>
                            <button class="btn-secondary" onclick="takeLoan(1000)" style="text-align: left; padding: 0.75rem;">
                                üíµ R$1.000 ‚Üí Pagar R$1.100 (juros 10%)
                            </button>
                        </div>
                    </div>
                    
                    ${currentPlayer.loans.length > 0 ? `
                    <!-- PAGAR EMPR√âSTIMOS -->
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <p style="color: #f87171; font-weight: 600; margin: 0 0 0.75rem 0;">
                            üí≥ Seus Empr√©stimos
                        </p>
                        <div style="display: grid; gap: 0.5rem;">
                            ${currentPlayer.loans.map((loan, index) => `
                                <button class="btn-secondary" onclick="payLoan(${index})" style="text-align: left; padding: 0.75rem;">
                                    üí∏ Pagar R$${loan.totalDue} (${loan.turnsRemaining} turnos restantes)
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${(currentPlayer.properties.length > 0 || currentPlayer.portTugs > 0 || currentPlayer.hasOceanTug || currentPlayer.hasTuglord) ? `
                    <!-- LIQUIDA√á√ÉO VOLUNT√ÅRIA -->
                    <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <p style="color: #fbbf24; font-weight: 600; margin: 0 0 0.75rem 0;">
                            üî® Liquida√ß√£o Volunt√°ria (50% do valor)
                        </p>
                        <div style="display: grid; gap: 0.5rem;">
                            ${currentPlayer.properties.map(propName => {
                                const prop = gameState.houses.find(h => h.name === propName);
                                const liquidationValue = Math.floor(prop.price * 0.5);
                                return `
                                    <button class="btn-secondary" onclick="liquidateAsset('property', '${propName.replace(/'/g, "\\'")}')" 
                                            style="text-align: left; padding: 0.75rem;">
                                        üè¢ ${propName} ‚Üí R$${liquidationValue}
                                    </button>
                                `;
                            }).join('')}
                            
                            ${currentPlayer.portTugs > 0 ? `
                                <button class="btn-secondary" onclick="liquidateAsset('port_tug', null)" 
                                        style="text-align: left; padding: 0.75rem;">
                                    ‚öì Rebocador Portu√°rio ‚Üí R$100
                                </button>
                            ` : ''}
                            
                            ${currentPlayer.hasOceanTug ? `
                                <button class="btn-secondary" onclick="liquidateAsset('ocean_tug', null)" 
                                        style="text-align: left; padding: 0.75rem;">
                                    œÅœÖ Rebocador Oce√¢nico ‚Üí R$250
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    ` : ''}
                </div>
                
                <button class="btn-primary" onclick="closeModal()" style="width: 100%;">
                    ‚úÖ Fechar Terminal
                </button>
            `;
            
            showModal('üè¶ Terminal Banc√°rio', modalBody, [], false);
        }
        
        function takeLoan(amount) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üí∞ === EMPR√âSTIMO BANC√ÅRIO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Valor solicitado: R$${amount}`);
            
            const interest = Math.floor(amount * 0.1); // 10% de juros
            const totalDue = amount + interest;
            const turnsToRepay = 5; // 5 turnos para pagar
            
            const loan = {
                principal: amount,
                interest: interest,
                totalDue: totalDue,
                turnsRemaining: turnsToRepay
            };
            
            currentPlayer.loans.push(loan);
            currentPlayer.money += amount;
            
            console.log(`   ‚úÖ Empr√©stimo aprovado!`);
            console.log(`   Recebido: R$${amount}`);
            console.log(`   Total a pagar: R$${totalDue}`);
            console.log(`   Prazo: ${turnsToRepay} turnos`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üí∞ === FIM DO EMPR√âSTIMO ===\n`);
            
            showNotification(`‚úÖ Empr√©stimo de R$${amount} aprovado! Pague R$${totalDue} em ${turnsToRepay} turnos.`);
            
            renderPlayersPanel();
            closeModal();
        }
        
        function payLoan(loanIndex) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const loan = currentPlayer.loans[loanIndex];
            
            console.log(`üí≥ === PAGAMENTO DE EMPR√âSTIMO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Valor a pagar: R$${loan.totalDue}`);
            console.log(`   Saldo atual: R$${currentPlayer.money}`);
            
            if (currentPlayer.money < loan.totalDue) {
                console.log(`   ‚ùå Saldo insuficiente!`);
                showNotification('‚ùå Saldo insuficiente para pagar empr√©stimo!');
                return;
            }
            
            currentPlayer.money -= loan.totalDue;
            currentPlayer.loans.splice(loanIndex, 1); // Remove empr√©stimo
            
            console.log(`   ‚úÖ Empr√©stimo quitado!`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üí≥ === FIM DO PAGAMENTO ===\n`);
            
            showNotification(`‚úÖ Empr√©stimo quitado! R$${loan.totalDue} pagos.`);
            
            renderPlayersPanel();
            closeModal();
            
            // Reabrir terminal atualizado
            setTimeout(() => openBankTerminal(), 300);
        }
        
        function liquidateAsset(assetType, assetId) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üî® === LIQUIDA√á√ÉO VOLUNT√ÅRIA ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Tipo: ${assetType}`);
            
            let liquidationValue = 0;
            let assetName = '';
            
            if (assetType === 'property') {
                const property = gameState.houses.find(h => h.name === assetId);
                liquidationValue = Math.floor(property.price * 0.5);
                assetName = property.name;
                
                // Remover propriedade
                property.owner = undefined;
                property.stocks = 0; // Limpar a√ß√µes tamb√©m
                currentPlayer.properties = currentPlayer.properties.filter(p => p !== assetId);
                
                // Remover a√ß√µes que o jogador tinha desta propriedade
                if (currentPlayer.stocks[assetId]) {
                    delete currentPlayer.stocks[assetId];
                }
                
            } else if (assetType === 'port_tug') {
                liquidationValue = 100;
                assetName = 'Rebocador Portu√°rio';
                currentPlayer.portTugs--;
                
            } else if (assetType === 'ocean_tug') {
                liquidationValue = 250;
                assetName = 'Rebocador Oce√¢nico';
                currentPlayer.hasOceanTug = false;
            }
            
            currentPlayer.money += liquidationValue;
            
            console.log(`   ‚úÖ ${assetName} liquidado!`);
            console.log(`   Valor recebido: R$${liquidationValue}`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üî® === FIM DA LIQUIDA√á√ÉO ===\n`);
            
            showNotification(`üî® ${assetName} vendido por R$${liquidationValue}!`);
            
            updatePlayerPositions(); // Atualizar barra de dono
            renderPlayersPanel();
            closeModal();
            
            // Reabrir terminal atualizado
            setTimeout(() => openBankTerminal(), 300);
        }

        function drawCard(type) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üçÄ === CARTA SORTE ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            
            const luckCards = [
                { text: 'üéâ Voc√™ ganhou na loteria!', effect: 'Receba R$500', money: 500 },
                { text: 'üí∞ B√¥nus de desempenho!', effect: 'Receba R$300', money: 300 },
                { text: 'üéÅ Presente do mar!', effect: 'Receba R$400', money: 400 },
                { text: 'üìà Contrato especial!', effect: 'Receba R$600', money: 600 },
                { text: 'üèÜ Pr√™mio de excel√™ncia!', effect: 'Receba R$250', money: 250 },
                { text: 'üìâ Imposto retroativo', effect: 'Pague R$200 ao Banco', money: -200 },
                { text: '‚õµ Manuten√ß√£o necess√°ria', effect: 'Pague R$150 ao Banco', money: -150 },
                { text: 'üí∏ Multa ambiental', effect: 'Pague R$100 ao Banco', money: -100 },
                { text: 'üöÄ Correntes favor√°veis!', effect: 'Avance 3 casas', move: 3 },
                { text: '‚öì √Åguas agitadas!', effect: 'Avance 2 casas', move: 2 },
                { text: '‚è™ Mar√© contr√°ria', effect: 'Volte 2 casas', move: -2 },
                { text: 'üåä Corrente inversa', effect: 'Volte 3 casas', move: -3 },
                { text: 'üåü Dia de sorte!', effect: 'Jogue os dados novamente', extra: 'roll_again' },
                { text: 'üéØ Vento a favor!', effect: 'Jogue novamente ap√≥s esta jogada', extra: 'roll_again' }
            ];
            
            const card = luckCards[Math.floor(Math.random() * luckCards.length)];
            
            console.log(`   Carta sorteada: ${card.text}`);
            console.log(`   Efeito: ${card.effect}`);
            
            // Modal com carta
            const modalBody = `
                <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(34, 197, 94, 0.1)); padding: 2rem; border-radius: 0.75rem; border: 2px solid #fbbf24; text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">${card.text.split(' ')[0]}</div>
                    <p style="color: #e0e0e0; font-size: 1.3rem; font-weight: 600; margin: 0 0 0.5rem 0;">
                        ${card.text}
                    </p>
                    <p style="color: #94a3b8; font-size: 1rem; margin: 0;">
                        ${card.effect}
                    </p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                    <p style="color: #e0e0e0; margin: 0; text-align: center; font-size: 0.9rem;">
                        ${currentPlayer.name} ${card.money ? (card.money > 0 ? `recebeu R$${card.money}!` : `pagou R$${Math.abs(card.money)}!`) : ''}
                        ${card.move ? `${card.move > 0 ? 'avan√ßou' : 'voltou'} ${Math.abs(card.move)} casas!` : ''}
                        ${card.extra === 'roll_again' ? 'pode jogar novamente!' : ''}
                    </p>
                </div>
            `;
            
            showModal('üçÄ Carta Sorte', modalBody, [
                { text: '‚úÖ Continuar', onClick: 'closeModal()' }
            ]);
            
            // Apply card effects
            if (card.money) {
                if (card.money > 0) {
                    currentPlayer.money += card.money;
                    console.log(`   üí∞ +R$${card.money}`);
                } else {
                    const amountToPay = Math.abs(card.money);
                    handleMandatoryPayment(currentPlayer, amountToPay, "Carta Sorte");
                    console.log(`   üí∏ -R$${amountToPay}`);
                }
            }
            
            if (card.move) {
                console.log(`   üöÄ Movimento: ${card.move} casas`);
                setTimeout(() => {
                    closeModal();
                    movePlayer(card.move);
                }, 2000);
            }
            
            if (card.extra === 'roll_again') {
                console.log(`   üé≤ Permiss√£o para jogar novamente!`);
                gameState.diceRolled = false; // Permite jogar de novo
                document.getElementById('rollDiceBtn').disabled = false;
                showNotification(`üé≤ ${currentPlayer.name} pode jogar novamente!`);
            }
            
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üçÄ === FIM DA CARTA ===\n`);
            
            renderPlayersPanel();
            document.getElementById('contextualActions').style.display = 'none';
        }

        // ========== EVENTOS OCE√ÇNICOS ==========
        function triggerOceanEvent() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üåä === EVENTO OCE√ÇNICO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            
            // Sortear evento aleat√≥rio
            const event = OCEAN_EVENTS[Math.floor(Math.random() * OCEAN_EVENTS.length)];
            
            console.log(`   Evento sorteado: ${event.name}`);
            console.log(`   Efeito: ${event.effect}`);
            
            // Criar modal visual
            const modalBody = `
                <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1)); padding: 2rem; border-radius: 0.75rem; border: 2px solid #3b82f6; text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">${event.icon}</div>
                    <p style="color: #3b82f6; font-size: 1.5rem; font-weight: 600; margin: 0 0 0.5rem 0;">
                        ${event.name}
                    </p>
                    <p style="color: #94a3b8; font-size: 1rem; margin: 0 0 1rem 0;">
                        ${event.description}
                    </p>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem;">
                        <p style="color: #e0e0e0; margin: 0; font-size: 0.95rem;">
                            ${event.effect}
                        </p>
                    </div>
                </div>
            `;
            
            // Bot√µes dependem do tipo de evento
            let buttons = [];
            
            if (event.type === 'choice_salvage') {
                buttons = [
                    { text: '‚úÖ Aceitar (+R$400, perde turno)', onClick: `acceptSalvage()` },
                    { text: '‚ùå Recusar', onClick: `closeModal()` }
                ];
            } else if (event.type === 'choice_route') {
                buttons = [
                    { text: 'üß≠ Rota Norte (+3 casas)', onClick: `chooseRoute('north')` },
                    { text: 'üß≠ Rota Sul (+R$250)', onClick: `chooseRoute('south')` }
                ];
            } else {
                buttons = [
                    { text: '‚úÖ Continuar', onClick: `closeModal()` }
                ];
            }
            
            showModal('üåä Evento Oce√¢nico', modalBody, buttons);
            
            // Aplicar efeito (exceto para eventos com escolha)
            if (event.type !== 'choice_salvage' && event.type !== 'choice_route') {
                setTimeout(() => {
                    applyOceanEventEffect(event);
                }, 100);
            }
            
            document.getElementById('contextualActions').style.display = 'none';
        }
        
        function applyOceanEventEffect(event) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`   Aplicando efeito: ${event.type}`);
            
            switch(event.type) {
                case 'money':
                    if (event.amount > 0) {
                        currentPlayer.money += event.amount;
                        console.log(`   üí∞ +R$${event.amount}`);
                        showNotification(`üí∞ ${currentPlayer.name} recebeu R$${event.amount}!`);
                    } else {
                        const amountToPay = Math.abs(event.amount);
                        handleMandatoryPayment(currentPlayer, amountToPay, event.name);
                        console.log(`   üí∏ -R$${amountToPay}`);
                    }
                    break;
                    
                case 'move':
                    console.log(`   üöÄ Movimento: +${event.spaces} casas`);
                    setTimeout(() => {
                        closeModal();
                        movePlayer(event.spaces);
                    }, 1500);
                    break;
                    
                case 'advance_to_property':
                    console.log(`   ‚õµ Avan√ßando para pr√≥xima propriedade...`);
                    setTimeout(() => {
                        closeModal();
                        advanceToNextProperty(event.skipRent);
                    }, 1500);
                    break;
                    
                case 'return_to_last_property':
                    console.log(`   üåÄ Retornando √† √∫ltima propriedade...`);
                    setTimeout(() => {
                        closeModal();
                        returnToLastProperty();
                    }, 1500);
                    break;
                    
                case 'skip_turn':
                    console.log(`   ‚è∏Ô∏è Pr√≥ximo turno ser√° pulado`);
                    currentPlayer.skipNextTurn = true;
                    showNotification(`‚ö†Ô∏è ${currentPlayer.name} perder√° o pr√≥ximo turno!`);
                    break;
                    
                case 'inspection':
                    const requiredCerts = ['fire', 'rescue', 'collision', 'abandon'];
                    const hasAllCerts = requiredCerts.every(cert => 
                        currentPlayer.certificates.includes(cert)
                    );
                    
                    if (hasAllCerts) {
                        currentPlayer.money += 200;
                        console.log(`   ‚úÖ Certificados completos: +R$200`);
                        showNotification(`‚úÖ Inspe√ß√£o aprovada! ${currentPlayer.name} recebeu R$200!`);
                    } else {
                        handleMandatoryPayment(currentPlayer, 150, "Multa (Inspe√ß√£o)");
                        console.log(`   ‚ùå Certificados incompletos: -R$150`);
                    }
                    break;
            }
            
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`üåä === FIM DO EVENTO ===\n`);
            
            renderPlayersPanel();
        }
        
        // Fun√ß√µes auxiliares para eventos oce√¢nicos
        function advanceToNextProperty(skipRent) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            let currentPos = currentPlayer.position;
            let spacesToMove = 0;
            
            // Procurar pr√≥xima propriedade
            for (let i = 1; i <= 36; i++) {
                const checkPos = (currentPos + i) % 36;
                const house = gameState.houses[checkPos];
                
                if (house.type === 'property') {
                    spacesToMove = i;
                    console.log(`   Pr√≥xima propriedade encontrada: ${house.name} (${i} casas)`);
                    break;
                }
            }
            
            if (spacesToMove > 0) {
                if (skipRent) {
                    // Marcar para pular aluguel
                    currentPlayer.skipNextRent = true;
                    console.log(`   ‚õµ Aluguel ser√° PULADO nesta propriedade`);
                }
                
                movePlayer(spacesToMove);
            }
        }
        
        function returnToLastProperty() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            let currentPos = currentPlayer.position;
            
            // Procurar √∫ltima propriedade (voltando)
            for (let i = 1; i <= 36; i++) {
                const checkPos = (currentPos - i + 36) % 36;
                const house = gameState.houses[checkPos];
                
                if (house.type === 'property') {
                    const spacesToMove = -i;
                    console.log(`   √öltima propriedade encontrada: ${house.name} (${i} casas atr√°s)`);
                    movePlayer(spacesToMove);
                    break;
                }
            }
        }
        
        function acceptSalvage() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üé£ === SALVAMENTO ACEITO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            
            currentPlayer.money += 400;
            currentPlayer.skipNextTurn = true;
            
            console.log(`   üí∞ +R$400`);
            console.log(`   ‚è∏Ô∏è Pr√≥ximo turno pulado`);
            console.log(`üé£ === FIM DO SALVAMENTO ===\n`);
            
            showNotification(`üé£ ${currentPlayer.name} recebeu R$400 mas perder√° o pr√≥ximo turno!`);
            
            renderPlayersPanel();
            closeModal();
        }
        
        function chooseRoute(route) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üåÖ === ESCOLHA DE ROTA ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Rota escolhida: ${route}`);
            
            if (route === 'north') {
                console.log(`   üß≠ Rota Norte: +3 casas`);
                closeModal();
                setTimeout(() => {
                    movePlayer(3);
                }, 500);
            } else {
                currentPlayer.money += 250;
                console.log(`   üß≠ Rota Sul: +R$250`);
                showNotification(`üß≠ ${currentPlayer.name} escolheu Rota Sul e recebeu R$250!`);
                renderPlayersPanel();
                closeModal();
            }
            
            console.log(`üåÖ === FIM DA ESCOLHA ===\n`);
        }

        // ========== SISTEMA ECON√îMICO COMPLETO ==========
        
        function calculateRent(space, owner) {
            if (!space.rent) return 0;
            
            let level = 0;
            const portTugs = owner.portTugs - owner.dockedTugs.port;
            const hasOcean = owner.hasOceanTug && !owner.dockedTugs.ocean;
            const hasTuglord = owner.hasTuglord && !owner.dockedTugs.tuglord;
            
            if (portTugs >= 1) level = 1;
            if (portTugs >= 2) level = 2;
            if (portTugs >= 3) level = 3;
            if (hasOcean) level = 4;
            if (hasTuglord) level = 5;
            
            return space.rent[level];
        }
        
        function handleMandatoryPayment(player, amount, reason, recipient = null) {
            console.log(`üí∏ Pagamento obrigat√≥rio: ${player.name} deve pagar R$${amount} (${reason})`);
            
            if (player.money >= amount) {
                player.money -= amount;
                
                if (recipient) {
                    recipient.money += amount;
                    console.log(`   ‚úÖ R$${amount} transferido para ${recipient.name}`);
                } else {
                    console.log(`   ‚úÖ R$${amount} pago ao Banco`);
                }
                
                showNotification(`üí∏ ${player.name} pagou R$${amount} (${reason})`);
                renderPlayersPanel();
                return true;
            } else {
                console.log(`   ‚ùå ${player.name} n√£o tem dinheiro! Saldo: R$${player.money}`);
                console.log(`   ‚ö†Ô∏è INICIANDO PROCESSO DE ARRESTO...`);
                
                // INICIAR PROCESSO DE ARRESTO
                initiateArrest(player, amount, reason, recipient);
                return false;
            }
        }
        
        // ========== SISTEMA DE FAL√äNCIA ==========
        function initiateArrest(player, debtAmount, reason, creditor) {
            console.log(`‚öñÔ∏è === PROCESSO DE ARRESTO ===`);
            console.log(`   Jogador: ${player.name}`);
            console.log(`   D√≠vida: R$${debtAmount}`);
            console.log(`   Motivo: ${reason}`);
            console.log(`   Credor: ${creditor ? creditor.name : 'Banco'}`);
            
            player.bankruptcyStage = 1; // Arresto
            
            // Calcular valor total dos ativos (50% do pre√ßo)
            let totalAssetValue = 0;
            let assetsList = [];
            
            // Propriedades
            player.properties.forEach(propName => {
                const prop = gameState.houses.find(h => h.name === propName);
                const liquidationValue = Math.floor(prop.price * 0.5);
                totalAssetValue += liquidationValue;
                assetsList.push({
                    type: 'property',
                    name: propName,
                    value: liquidationValue,
                    asset: prop
                });
            });
            
            // Rebocadores portu√°rios
            for (let i = 0; i < player.portTugs; i++) {
                totalAssetValue += 100;
                assetsList.push({
                    type: 'port_tug',
                    name: `Rebocador Portu√°rio #${i + 1}`,
                    value: 100
                });
            }
            
            // Rebocador oce√¢nico
            if (player.hasOceanTug) {
                totalAssetValue += 250;
                assetsList.push({
                    type: 'ocean_tug',
                    name: 'Rebocador Oce√¢nico',
                    value: 250
                });
            }
            
            // TugLord
            if (player.hasTuglord) {
                totalAssetValue += 375; // 50% de 750
                assetsList.push({
                    type: 'tuglord',
                    name: 'Classe TugLord',
                    value: 375
                });
            }
            
            console.log(`   Valor total dos ativos: R$${totalAssetValue}`);
            console.log(`   Saldo em caixa: R$${player.money}`);
            
            const totalAvailable = player.money + totalAssetValue;
            
            console.log(`   Total dispon√≠vel: R$${totalAvailable}`);
            
            if (totalAvailable >= debtAmount) {
                // TEM ATIVOS SUFICIENTES - LIQUIDA√á√ÉO FOR√áADA
                console.log(`   ‚úÖ Ativos suficientes para cobrir d√≠vida`);
                console.log(`   üî® INICIANDO LIQUIDA√á√ÉO FOR√áADA...`);
                
                forceLiquidation(player, debtAmount, assetsList, creditor);
                
            } else {
                // N√ÉO TEM ATIVOS SUFICIENTES - FAL√äNCIA
                console.log(`   ‚ùå Ativos insuficientes para cobrir d√≠vida`);
                console.log(`   üíî DECLARANDO FAL√äNCIA...`);
                
                declareBankruptcy(player, creditor);
            }
        }
        
        function forceLiquidation(player, debtAmount, assetsList, creditor) {
            console.log(`üî® === LIQUIDA√á√ÉO FOR√áADA ===`);
            
            let amountRaised = player.money; // Come√ßa com saldo atual
            let liquidatedAssets = [];
            
            // Liquidar ativos at√© cobrir a d√≠vida
            for (let asset of assetsList) {
                if (amountRaised >= debtAmount) break; // J√° cobriu a d√≠vida
                
                console.log(`   Liquidando: ${asset.name} ‚Üí R$${asset.value}`);
                
                if (asset.type === 'property') {
                    // Remover propriedade
                    asset.asset.owner = undefined;
                    asset.asset.stocks = 0;
                    player.properties = player.properties.filter(p => p !== asset.name);
                    
                    // Limpar a√ß√µes desta propriedade
                    if (player.stocks[asset.name]) {
                        delete player.stocks[asset.name];
                    }
                    
                } else if (asset.type === 'port_tug') {
                    player.portTugs--;
                    
                } else if (asset.type === 'ocean_tug') {
                    player.hasOceanTug = false;
                    
                } else if (asset.type === 'tuglord') {
                    player.hasTuglord = false;
                }
                
                amountRaised += asset.value;
                liquidatedAssets.push(asset.name);
            }
            
            // Usar dinheiro do jogador primeiro
            const cashUsed = Math.min(player.money, debtAmount);
            player.money -= cashUsed;
            
            // Resto vem dos ativos
            const fromAssets = Math.min(amountRaised - cashUsed, debtAmount - cashUsed);
            
            // Pagar credor
            if (creditor) {
                creditor.money += debtAmount;
                console.log(`   ‚úÖ R$${debtAmount} transferido para ${creditor.name}`);
            }
            
            // Sobra vai para o jogador
            const surplus = amountRaised - debtAmount;
            if (surplus > 0) {
                player.money += surplus;
                console.log(`   üí∞ Sobra de R$${surplus} devolvida ao jogador`);
            }
            
            player.bankruptcyStage = 0; // Volta a solvente
            
            console.log(`   ‚úÖ D√≠vida quitada!`);
            console.log(`   Ativos liquidados: ${liquidatedAssets.length}`);
            console.log(`   Novo saldo: R$${player.money}`);
            console.log(`üî® === FIM DA LIQUIDA√á√ÉO ===\n`);
            
            showNotification(`üî® ${player.name}: Ativos liquidados para quitar d√≠vida de R$${debtAmount}!`);
            
            // Modal informativo
            setTimeout(() => {
                const modalBody = `
                    <div style="background: rgba(239, 68, 68, 0.1); padding: 1.5rem; border-radius: 0.5rem; border-left: 4px solid #ef4444; margin-bottom: 1rem;">
                        <p style="color: #f87171; font-weight: 600; margin: 0 0 0.5rem 0;">
                            ‚öñÔ∏è LIQUIDA√á√ÉO FOR√áADA
                        </p>
                        <p style="color: #94a3b8; margin: 0;">
                            Seus ativos foram liquidados para quitar a d√≠vida de R$${debtAmount}.
                        </p>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <p style="color: #e0e0e0; font-weight: 600; margin: 0 0 0.5rem 0;">
                            Ativos Liquidados:
                        </p>
                        ${liquidatedAssets.map(asset => `
                            <p style="color: #94a3b8; margin: 0.25rem 0; font-size: 0.9rem;">
                                ‚Ä¢ ${asset}
                            </p>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem;">
                        <p style="color: #22c55e; margin: 0;">
                            ‚úÖ D√≠vida quitada. Saldo atual: R$${player.money}
                        </p>
                    </div>
                `;
                
                showModal('‚öñÔ∏è Liquida√ß√£o For√ßada', modalBody, [
                    { text: 'Entendi', onClick: 'closeModal()' }
                ]);
            }, 1500);
            
            updatePlayerPositions();
            renderPlayersPanel();
        }
        
        function declareBankruptcy(player, creditor) {
            console.log(`üíî === FAL√äNCIA DECLARADA ===`);
            console.log(`   Jogador: ${player.name}`);
            
            player.bankruptcyStage = 2; // Falido
            player.isEliminated = true;
            
            // Transferir TODOS os ativos liquidados para o credor
            let totalTransferred = player.money;
            
            // Liquidar todas as propriedades
            player.properties.forEach(propName => {
                const prop = gameState.houses.find(h => h.name === propName);
                const liquidationValue = Math.floor(prop.price * 0.5);
                totalTransferred += liquidationValue;
                
                // Limpar propriedade
                prop.owner = undefined;
                prop.stocks = 0;
            });
            
            // Rebocadores
            totalTransferred += player.portTugs * 100;
            if (player.hasOceanTug) totalTransferred += 250;
            if (player.hasTuglord) totalTransferred += 375;
            
            // Transferir ao credor (ou banco)
            if (creditor) {
                creditor.money += totalTransferred;
                console.log(`   üí∞ R$${totalTransferred} transferido para ${creditor.name}`);
            } else {
                console.log(`   üí∞ R$${totalTransferred} confiscado pelo Banco`);
            }
            
            // Zerar jogador
            player.money = 0;
            player.properties = [];
            player.portTugs = 0;
            player.hasOceanTug = false;
            player.hasTuglord = false;
            player.stocks = {};
            
            console.log(`   ‚ùå ${player.name} est√° FALIDO!`);
            console.log(`üíî === FIM DA FAL√äNCIA ===\n`);
            
            showNotification(`üíî ${player.name} declarou FAL√äNCIA e foi eliminado do jogo!`);
            
            // Modal de fal√™ncia
            setTimeout(() => {
                const modalBody = `
                    <div style="background: rgba(239, 68, 68, 0.2); padding: 2rem; border-radius: 0.75rem; border: 2px solid #ef4444; text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üíî</div>
                        <p style="color: #f87171; font-size: 1.5rem; font-weight: 700; margin: 0 0 1rem 0;">
                            FAL√äNCIA DECLARADA
                        </p>
                        <p style="color: #e0e0e0; font-size: 1.1rem; margin: 0 0 0.5rem 0;">
                            ${player.name}
                        </p>
                        <p style="color: #94a3b8; margin: 0;">
                            foi eliminado do jogo por insolv√™ncia.
                        </p>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin-top: 1.5rem;">
                        <p style="color: #94a3b8; margin: 0; text-align: center; font-size: 0.9rem;">
                            Todos os ativos foram liquidados e transferidos ${creditor ? `para ${creditor.name}` : 'ao Banco'}.
                        </p>
                    </div>
                `;
                
                showModal('üíî Game Over', modalBody, [
                    { text: 'Continuar Jogo', onClick: 'closeModal()' }
                ]);
            }, 2000);
            
            updatePlayerPositions();
            renderPlayersPanel();
            
            // Verificar se s√≥ resta 1 jogador (vit√≥ria)
            const activePlayers = gameState.players.filter(p => !p.isEliminated);
            if (activePlayers.length === 1) {
                setTimeout(() => {
                    declareWinner(activePlayers[0]);
                }, 3000);
            }
        }
        
        function declareWinner(winner) {
            console.log(`üèÜ === VIT√ìRIA ===`);
            console.log(`   Vencedor: ${winner.name}`);
            
            const modalBody = `
                <div style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(34, 197, 94, 0.2)); padding: 3rem; border-radius: 1rem; border: 3px solid #fbbf24; text-align: center;">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">üèÜ</div>
                    <p style="color: #fbbf24; font-size: 2rem; font-weight: 700; margin: 0 0 1rem 0; text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);">
                        VIT√ìRIA!
                    </p>
                    <p style="color: #e0e0e0; font-size: 1.5rem; font-weight: 600; margin: 0 0 0.5rem 0;">
                        ${winner.icon} ${winner.name}
                    </p>
                    <p style="color: #22c55e; font-size: 1.2rem; margin: 0 0 1.5rem 0;">
                        R$ ${winner.money}
                    </p>
                    <p style="color: #94a3b8; margin: 0;">
                        Todos os advers√°rios foram eliminados!<br>
                        Voc√™ √© o TugLord supremo dos mares brasileiros!
                    </p>
                </div>
            `;
            
            showModal('üèÜ Vit√≥ria por Elimina√ß√£o!', modalBody, [
                { text: 'üéâ Nova Partida', onClick: 'location.reload()' }
            ]);
        }
        
        function buyProperty(space) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            console.log(`üè™ === COMPRA DE PROPRIEDADE ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Propriedade: ${space.name}`);
            console.log(`   Pre√ßo: R$${space.price}`);
            console.log(`   Saldo atual: R$${currentPlayer.money}`);
            
            // Verificar se tem dinheiro
            if (currentPlayer.money < space.price) {
                showNotification('‚ùå Saldo insuficiente!');
                console.log(`   ‚ùå Compra CANCELADA: saldo insuficiente`);
                return;
            }
            
            // Debitar dinheiro
            currentPlayer.money -= space.price;
            
            // Registrar ownership
            space.owner = currentPlayer.id;
            
            // Adicionar √† lista de propriedades
            currentPlayer.properties.push(space.name);
            
            console.log(`   ‚úÖ Compra APROVADA!`);
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`   Owner ID: ${space.owner}`);
            console.log(`üè™ === FIM DA COMPRA ===\n`);
            
            showNotification(`‚úÖ ${space.name} adquirido!`);
            renderPlayersPanel();
            
            document.getElementById('contextualActions').style.display = 'none';
        }
        
        function buyTug(space) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const tugType = space.tugType; // 'port' ou 'ocean'
            const price = space.price;
            
            console.log(`‚öì === COMPRA DE REBOCADOR ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Tipo: ${tugType === 'port' ? 'Portu√°rio' : 'Oce√¢nico'}`);
            console.log(`   Pre√ßo: R$${price}`);
            console.log(`   Saldo atual: R$${currentPlayer.money}`);
            
            // Verificar se tem dinheiro
            if (currentPlayer.money < price) {
                showNotification('‚ùå Saldo insuficiente!');
                console.log(`   ‚ùå Compra CANCELADA: saldo insuficiente`);
                return;
            }
            
            // Verificar se j√° tem (para oce√¢nico)
            if (tugType === 'ocean' && currentPlayer.hasOceanTug) {
                showNotification('‚ö†Ô∏è Voc√™ j√° possui um Rebocador Oce√¢nico!');
                console.log(`   ‚ùå Compra CANCELADA: j√° possui rebocador oce√¢nico`);
                return;
            }
            
            // Debitar dinheiro
            currentPlayer.money -= price;
            
            // Adicionar rebocador
            if (tugType === 'port') {
                currentPlayer.portTugs++;
                console.log(`   ‚úÖ Rebocador Portu√°rio adquirido!`);
                console.log(`   Total de portu√°rios: ${currentPlayer.portTugs}`);
                showNotification(`‚öì Rebocador Portu√°rio adquirido! Total: ${currentPlayer.portTugs}`);
            } else if (tugType === 'ocean') {
                currentPlayer.hasOceanTug = true;
                console.log(`   ‚úÖ Rebocador Oce√¢nico adquirido!`);
                showNotification(`œÅœÖ Rebocador Oce√¢nico adquirido!`);
            }
            
            console.log(`   Novo saldo: R$${currentPlayer.money}`);
            console.log(`‚öì === FIM DA COMPRA ===\n`);
            
            renderPlayersPanel();
            document.getElementById('contextualActions').style.display = 'none';
        }


        function showLoanOptions() {
            openPanel('panelBank');
            showNotification('üí≥ Escolha o valor do empr√©stimo');
        }

        function endTurn() {
            if (!gameState.diceRolled) {
                showNotification('‚ö†Ô∏è Role os dados primeiro!');
                return;
            }

            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            
            if (gameState.currentPlayerIndex === 0) {
                gameState.currentRound++;
            }
            
            document.getElementById('contextualActions').style.display = 'none';
            
            // ===== PAGAR DIVIDENDOS AO JOGADOR ATUAL =====
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            // ===== VERIFICAR SKIP TURN (Evento Oce√¢nico) =====
            if (currentPlayer.skipNextTurn) {
                console.log(`‚è∏Ô∏è ${currentPlayer.name} est√° PULANDO o turno!`);
                currentPlayer.skipNextTurn = false; // Reset flag
                gameState.diceRolled = true; // Marca como se j√° tivesse rolado
                
                showNotification(`‚è∏Ô∏è ${currentPlayer.name} perdeu o turno! (Evento Oce√¢nico)`);
                
                // Pula para o pr√≥ximo jogador
                updateTurnDisplay();
                updatePlayerPositions();
                renderPlayersPanel();
                return; // Sai da fun√ß√£o sem permitir jogar
            }
            
            if (currentPlayer.properties.length > 0 && !currentPlayer.isEliminated) {
                payDividends(currentPlayer);
            }
            
            // ===== VERIFICAR DOCAGEM NO IN√çCIO DO TURNO =====
            checkDockingStatus();
            
            updateTurnDisplay();
            updatePlayerPositions();
            renderPlayersPanel();
        }
        
        // ========== SISTEMA DE DOCAGEM ==========
        function checkDockingStatus() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            if (currentPlayer.dockedTugs.turnsRemaining > 0) {
                currentPlayer.dockedTugs.turnsRemaining--;
                
                console.log(`‚öì Docagem de ${currentPlayer.name}: ${currentPlayer.dockedTugs.turnsRemaining} turnos restantes`);
                
                if (currentPlayer.dockedTugs.turnsRemaining === 0) {
                    // LIBERAR REBOCADORES
                    if (currentPlayer.dockedTugs.port > 0) {
                        currentPlayer.dockedTugs.port = 0;
                        console.log(`   ‚úÖ Rebocadores portu√°rios liberados!`);
                    }
                    if (currentPlayer.dockedTugs.ocean) {
                        currentPlayer.dockedTugs.ocean = false;
                        console.log(`   ‚úÖ Rebocador oce√¢nico liberado!`);
                    }
                    if (currentPlayer.dockedTugs.tuglord) {
                        currentPlayer.dockedTugs.tuglord = false;
                        console.log(`   ‚úÖ Classe TugLord liberada!`);
                    }
                    
                    showNotification(`‚úÖ ${currentPlayer.name}: Rebocadores liberados da docagem!`);
                } else {
                    showNotification(`‚öì ${currentPlayer.name}: Rebocador(es) ainda em docagem (${currentPlayer.dockedTugs.turnsRemaining} turnos)`);
                }
            }
        }
        
        function handleShipyard(space) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const owner = space.owner !== undefined ? gameState.players.find(p => p.id === space.owner) : null;
            
            console.log(`üè≠ === ESTALEIRO ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Dono: ${owner ? owner.name : 'Sem dono'}`);
            
            // Contar rebocadores operacionais
            const operationalPortTugs = currentPlayer.portTugs - currentPlayer.dockedTugs.port;
            const operationalOceanTug = currentPlayer.hasOceanTug && !currentPlayer.dockedTugs.ocean;
            const operationalTuglord = currentPlayer.hasTuglord && !currentPlayer.dockedTugs.tuglord;
            
            const hasOperationalTugs = operationalPortTugs > 0 || operationalOceanTug || operationalTuglord;
            
            console.log(`   Rebocadores operacionais: Port=${operationalPortTugs}, Ocean=${operationalOceanTug}, TugLord=${operationalTuglord}`);
            
            if (!hasOperationalTugs) {
                console.log(`   ‚ÑπÔ∏è Sem rebocadores operacionais, sem docagem necess√°ria`);
                console.log(`üè≠ === FIM DO ESTALEIRO ===\n`);
                return; // Sem rebocadores, sem docagem
            }
            
            // TEM REBOCADORES = DOCAGEM OBRIGAT√ìRIA
            const dockingCost = space.repairCost || 75;
            
            // Criar lista de rebocadores dispon√≠veis para docar
            let tugOptions = [];
            
            if (operationalPortTugs > 0) {
                tugOptions.push({
                    label: `‚öì Rebocador Portu√°rio (${operationalPortTugs} operacional)`,
                    value: 'port'
                });
            }
            
            if (operationalOceanTug) {
                tugOptions.push({
                    label: `œÅœÖ Rebocador Oce√¢nico`,
                    value: 'ocean'
                });
            }
            
            if (operationalTuglord) {
                tugOptions.push({
                    label: `‚≠ê Classe TugLord`,
                    value: 'tuglord'
                });
            }
            
            // Modal para escolher qual rebocador docar
            const modalBody = `
                <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 4px solid #ef4444;">
                    <p style="color: #f87171; font-weight: 600; margin: 0;">
                        ‚ö†Ô∏è DOCAGEM OBRIGAT√ìRIA
                    </p>
                    <p style="color: #94a3b8; font-size: 0.85rem; margin: 0.5rem 0 0 0;">
                        Voc√™ possui rebocadores operacionais e deve docar um deles por 3 turnos.
                    </p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                    <p style="color: #e0e0e0; margin: 0;">
                        üí∞ Custo da docagem: <strong style="color: #fbbf24;">R$${dockingCost}</strong>
                    </p>
                    <p style="color: #94a3b8; font-size: 0.85rem; margin: 0.5rem 0 0 0;">
                        ${owner ? `Pago para ${owner.name}` : 'Pago ao Banco'}
                    </p>
                </div>
                
                <p style="color: #e0e0e0; font-weight: 600; margin-bottom: 0.75rem;">
                    Selecione qual rebocador docar:
                </p>
                
                <div style="display: grid; gap: 0.75rem;">
                    ${tugOptions.map(tug => `
                        <button class="btn-secondary" 
                                onclick="executeDocking('${tug.value}', ${dockingCost}, ${owner ? owner.id : 'null'})"
                                style="text-align: left; padding: 1rem; font-size: 0.95rem;">
                            ${tug.label}
                        </button>
                    `).join('')}
                </div>
            `;
            
            showModal('üè≠ Estaleiro - Docagem Obrigat√≥ria', modalBody, [], false);
        }
        
        function executeDocking(tugType, cost, ownerId) {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const owner = ownerId ? gameState.players.find(p => p.id === ownerId) : null;
            
            console.log(`‚öì === EXECUTANDO DOCAGEM ===`);
            console.log(`   Jogador: ${currentPlayer.name}`);
            console.log(`   Rebocador: ${tugType}`);
            console.log(`   Custo: R$${cost}`);
            
            // Pagar custo de docagem
            if (!handleMandatoryPayment(currentPlayer, cost, "Docagem", owner)) {
                console.log(`   ‚ùå Pagamento falhou!`);
                closeModal();
                return;
            }
            
            // Docar rebocador
            if (tugType === 'port') {
                currentPlayer.dockedTugs.port = 1; // Doca 1 portu√°rio
            } else if (tugType === 'ocean') {
                currentPlayer.dockedTugs.ocean = true;
            } else if (tugType === 'tuglord') {
                currentPlayer.dockedTugs.tuglord = true;
            }
            
            // Setar dura√ß√£o da docagem
            currentPlayer.dockedTugs.turnsRemaining = 3;
            
            console.log(`   ‚úÖ Docagem realizada! Dura√ß√£o: 3 turnos`);
            console.log(`‚öì === FIM DA DOCAGEM ===\n`);
            
            showNotification(`‚öì Rebocador docado por 3 turnos!`);
            
            renderPlayersPanel();
            closeModal();
        }

        // ========== UI FUNCTIONS ==========
        function openPanel(panelId, button) {
            closeAllPanels();
            
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.classList.add('active');
                document.getElementById('panelOverlay').classList.add('active');
            }

            if (button) {
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            }
        }

        function closePanel(panelId) {
            const panel = document.getElementById(panelId);
            if (panel) {
                panel.classList.remove('active');
            }
            
            const anyPanelOpen = document.querySelector('.sliding-panel.active');
            if (!anyPanelOpen) {
                document.getElementById('panelOverlay').classList.remove('active');
            }
        }

        function closeAllPanels() {
            document.querySelectorAll('.sliding-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById('panelOverlay').classList.remove('active');
        }

        function toggleBoard(button) {
            // On mobile, board is already visible
            // This could scroll to board or do nothing
            closeAllPanels();
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }

        function switchTab(button, tabId) {
            const card = button.closest('.player-card');
            
            card.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            card.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: ${gameState.phase === 'setup' ? '20px' : '80px'};
                left: 50%;
                transform: translateX(-50%);
                background: rgba(251, 191, 36, 0.95);
                color: #1a2942;
                padding: 1rem 1.5rem;
                border-radius: 0.75rem;
                font-weight: 700;
                z-index: 1000;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                animation: slideDown 0.3s ease;
                max-width: 90%;
                text-align: center;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // ========== INITIALIZATION ==========
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üö¢ TUGLORDS v15.0 - Mobile First Edition loaded!');
            
            // Add default players
            addPlayer();
            addPlayer();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllPanels();
            }
            if (gameState.phase === 'playing') {
                if (e.key === ' ' || e.key === 'Enter') {
                    if (!gameState.diceRolled) rollDice();
                }
                if (e.key === 'n' || e.key === 'N') {
                    if (gameState.diceRolled) endTurn();
                }
            }
        });

        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                to { transform: translateX(-50%) translateY(0); opacity: 1; }
            }
            @keyframes slideUp {
                from { transform: translateX(-50%) translateY(0); opacity: 1; }
                to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
            }
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
